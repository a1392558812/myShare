# 乒乓球 demo

<iframe width="100%" height="500px" frameborder="1" scrolling="auto" src="https://code.juejin.cn/pen/7539838113990377510"></iframe>

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Simple Pong Game</title>
  </head>
  <body>
    <canvas id="pong" width="800" height="500"></canvas>
  </body>
</html>
```

```css
body {
  background: #222;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}

canvas {
  background: #111;
  box-shadow: 0 0 20px #000;
  border: 2px solid #fff;
  display: block;
}
```

```javascript
// 游戏常量
const canvas = document.getElementById("pong");
const ctx = canvas.getContext("2d");
const WIDTH = canvas.width;
const HEIGHT = canvas.height;

const PADDLE_WIDTH = 15;
const PADDLE_HEIGHT = 100;
const BALL_SIZE = 15;

let leftScore = 0;
let rightScore = 0;

// 左侧和右侧球拍对象
const leftPaddle = {
  x: 10,
  y: HEIGHT / 2 - PADDLE_HEIGHT / 2,
  width: PADDLE_WIDTH,
  height: PADDLE_HEIGHT,
  dy: 0,
};

const rightPaddle = {
  x: WIDTH - PADDLE_WIDTH - 10,
  y: HEIGHT / 2 - PADDLE_HEIGHT / 2,
  width: PADDLE_WIDTH,
  height: PADDLE_HEIGHT,
  dy: 4, // 电脑球拍速度
};

// 小球对象
const ball = {
  x: WIDTH / 2 - BALL_SIZE / 2,
  y: HEIGHT / 2 - BALL_SIZE / 2,
  size: BALL_SIZE,
  speed: 5,
  dx: 5 * (Math.random() > 0.5 ? 1 : -1),
  dy: 5 * (Math.random() > 0.5 ? 1 : -1),
};

// 绘制所有元素
function draw() {
  ctx.clearRect(0, 0, WIDTH, HEIGHT);

  // 绘制中线
  ctx.strokeStyle = "#fff";
  ctx.setLineDash([8, 8]);
  ctx.beginPath();
  ctx.moveTo(WIDTH / 2, 0);
  ctx.lineTo(WIDTH / 2, HEIGHT);
  ctx.stroke();
  ctx.setLineDash([]);

  // 绘制球拍
  ctx.fillStyle = "#fff";
  ctx.fillRect(leftPaddle.x, leftPaddle.y, PADDLE_WIDTH, PADDLE_HEIGHT);
  ctx.fillRect(rightPaddle.x, rightPaddle.y, PADDLE_WIDTH, PADDLE_HEIGHT);

  // 绘制小球
  ctx.fillStyle = "#fff";
  ctx.fillRect(ball.x, ball.y, BALL_SIZE, BALL_SIZE);

  // 绘制记分板
  ctx.font = "48px monospace";
  ctx.fillText(leftScore, WIDTH / 2 - 80, 60);
  ctx.fillText(rightScore, WIDTH / 2 + 40, 60);
}

// 移动球拍
function movePaddles() {
  // 左侧球拍（玩家）- 键盘控制
  leftPaddle.y += leftPaddle.dy;

  // 限制左侧球拍不能超出画布
  if (leftPaddle.y < 0) leftPaddle.y = 0;
  if (leftPaddle.y + PADDLE_HEIGHT > HEIGHT)
    leftPaddle.y = HEIGHT - PADDLE_HEIGHT;

  // 右侧球拍（电脑自动）
  if (ball.y + BALL_SIZE / 2 > rightPaddle.y + PADDLE_HEIGHT / 2) {
    rightPaddle.y += rightPaddle.dy;
  } else if (ball.y + BALL_SIZE / 2 < rightPaddle.y + PADDLE_HEIGHT / 2) {
    rightPaddle.y -= rightPaddle.dy;
  }
  // 限制右侧球拍不能超出画布
  if (rightPaddle.y < 0) rightPaddle.y = 0;
  if (rightPaddle.y + PADDLE_HEIGHT > HEIGHT)
    rightPaddle.y = HEIGHT - PADDLE_HEIGHT;
}

// 小球的移动和碰撞检测
function moveBall() {
  ball.x += ball.dx;
  ball.y += ball.dy;

  // 顶部/底部墙壁碰撞
  if (ball.y < 0 || ball.y + BALL_SIZE > HEIGHT) {
    ball.dy *= -1;
  }

  // 左侧球拍碰撞
  if (
    ball.x < leftPaddle.x + leftPaddle.width &&
    ball.x + BALL_SIZE > leftPaddle.x &&
    ball.y < leftPaddle.y + leftPaddle.height &&
    ball.y + BALL_SIZE > leftPaddle.y
  ) {
    ball.dx = Math.abs(ball.dx);
    // 增加旋转效果
    let collidePoint =
      ball.y + BALL_SIZE / 2 - (leftPaddle.y + PADDLE_HEIGHT / 2);
    ball.dy = collidePoint * 0.2;
  }

  // 右侧球拍碰撞
  if (
    ball.x + BALL_SIZE > rightPaddle.x &&
    ball.x < rightPaddle.x + rightPaddle.width &&
    ball.y < rightPaddle.y + rightPaddle.height &&
    ball.y + BALL_SIZE > rightPaddle.y
  ) {
    ball.dx = -Math.abs(ball.dx);
    // 增加旋转效果
    let collidePoint =
      ball.y + BALL_SIZE / 2 - (rightPaddle.y + PADDLE_HEIGHT / 2);
    ball.dy = collidePoint * 0.2;
  }

  // 得分逻辑
  if (ball.x < 0) {
    rightScore++;
    resetBall();
  } else if (ball.x + BALL_SIZE > WIDTH) {
    leftScore++;
    resetBall();
  }
}

// 重置小球到中心
function resetBall() {
  ball.x = WIDTH / 2 - BALL_SIZE / 2;
  ball.y = HEIGHT / 2 - BALL_SIZE / 2;
  ball.dx = ball.speed * (Math.random() > 0.5 ? 1 : -1);
  ball.dy = ball.speed * (Math.random() > 0.5 ? 1 : -1);
}

// 鼠标控制左侧球拍
canvas.addEventListener("mousemove", function (e) {
  const rect = canvas.getBoundingClientRect();
  const mouseY = e.clientY - rect.top;
  leftPaddle.y = mouseY - PADDLE_HEIGHT / 2;
  if (leftPaddle.y < 0) leftPaddle.y = 0;
  if (leftPaddle.y + PADDLE_HEIGHT > HEIGHT)
    leftPaddle.y = HEIGHT - PADDLE_HEIGHT;
});

// 键盘控制左侧球拍
document.addEventListener("keydown", function (e) {
  if (e.key === "ArrowUp") leftPaddle.dy = -8;
  if (e.key === "ArrowDown") leftPaddle.dy = 8;
});
document.addEventListener("keyup", function (e) {
  if (e.key === "ArrowUp" || e.key === "ArrowDown") leftPaddle.dy = 0;
});

// 游戏主循环
function update() {
  movePaddles();
  moveBall();
  draw();
  requestAnimationFrame(update);
}

// 启动游戏
update();
```
