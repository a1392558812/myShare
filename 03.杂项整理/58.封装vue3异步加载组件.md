## å°è£…vue3å¼‚æ­¥åŠ è½½ç»„ä»¶

> å¦‚æœéœ€è¦è‡ªè¡Œæµ‹è¯•ï¼Œå»ºè®®å¯åŠ¨æœ¬åœ°`vite+vue3`æœåŠ¡

å…ˆå®šä¹‰ä¸‹test2.vueï¼Œè¿™æ˜¯æˆ‘ä»¬ç­‰ä¼šéœ€è¦å¼‚æ­¥åŠ è½½çš„ç»„ä»¶

test2.vue ğŸ‘‡

```html
<template>
  <div style="color: pink">è¿™ä¸ªæ˜¯test2ç»„ä»¶</div>
</template>
<script>
export default {
  setup(props, { attrs }) {
    console.log('test2ç»„ä»¶æ¥å—props: ', attrs)
    return {}
  }
}
</script>
```

å®šä¹‰error.vueå’Œloading.vueï¼Œè¿™æ˜¯æˆ‘ä»¬ç­‰ä¼šéœ€è¦ç”¨åˆ°çš„ç»„ä»¶ï¼Œè¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘å°±ç®€å•æ„æ€ä¸‹

error.vue ğŸ‘‡

```html
<template>
    <div>error</div>
</template>
```

loading.vue ğŸ‘‡

```html
<template>
    <div>loading....</div>
</template>
```

> asyncComFunä¸asyncCom1Funé€‰æ‹©ä¸€ä¸ªç”¨å³å¯ï¼Œéƒ½ä¸€æ ·çš„ï¼Œçœ‹è‡ªå·±éœ€æ±‚éœ€è¦ç”¨å“ªä¸€ç§

### å®šä¹‰å…±ç”¨å¼‚æ­¥åŠ è½½ç»„ä»¶ã€asyncComFunã€‘æ–¹æ³•ä¸€(å¤æ‚ç‰ˆ)

ä¼˜åŠ¿ï¼š å¯è‡ªå®šä¹‰æ‰©å±•slotå’Œä¼ å‚ï¼Œæ‰©å±•æ€§å¼º

```html
<script lang="jsx">
import { defineAsyncComponent } from 'vue';
import errorComponent from './error.vue';
import loadingComponent from './loading.vue';
import { ref } from 'vue'

export default (loader, options = {}) => ({
  components:{
    asyncCom: defineAsyncComponent({
      loader: () => {
        // ......è‡ªå®šä¹‰æ‹“å±•
        return loader()
      },
      delay: options.delay || 200,
      timeout: options.timeout || 10000,
      errorComponent: options.errorComponent || errorComponent,
      loadingComponent: options.loadingComponent|| loadingComponent,
    })
  },
  setup(props, { attrs, emit, expose, slots }) {
    console.log('setup', { props, attrs, emit, expose, slots })
    return {}
  },
  render() {
    return (
    <>
        <Suspense>
            <asyncCom {...this.$attrs}/>
        </Suspense>
    </>
    )
  }
});
</script>

```

### å®šä¹‰å…±ç”¨å¼‚æ­¥åŠ è½½ç»„ä»¶ã€asyncCom1Funã€‘æ–¹æ³•ä¸€(ç®€å•ç‰ˆ)

ä¼˜åŠ¿ï¼š ç®€å•æ˜“ç”¨

```html
<script lang="jsx">
import { defineAsyncComponent } from 'vue';
import errorComponent from './error.vue';
import loadingComponent from './loading.vue';
import { ref } from 'vue'

export default (loader, options = {}) => defineAsyncComponent({
    loader: () => {
        return loader()
    },
    delay: options.delay || 200,
    timeout: options.timeout || 10000,
    errorComponent: options.errorComponent || errorComponent,
    loadingComponent: options.loadingComponent|| loadingComponent,
});
</script>
```

### ä½¿ç”¨

```html
<template>
    <div class="test">
        <!-- æ¼”ç¤º1 -->
        <test style="margin-bottom: 10px" :msg="111" />
        <!-- æ¼”ç¤º2 -->
        <test1 style="margin-bottom: 20px" :msg="222" />
    </div>
</template>
<script setup>
import asyncComFun from './components/asyncCom.vue'
import asyncCom1Fun from './components/asyncCom1.vue'
import errorComponent from './error.vue';
import loadingComponent from './loading.vue';

console.log('asyncComFun', { asyncComFun, asyncCom1Fun })

// æ¨¡æ‹Ÿç½‘ç»œå¼‚å¸¸
const flagFun = (resolve, reject) => {
    let date = new Date()
    date = date.getTime()
    return date % 2 > 0 ? resolve : reject
}

const test = asyncComFun(() => {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            flagFun(resolve, reject)(import('./components/test2.vue'))
        }, 3000)
    })
}, {
    delay: 0,
    timeout: 30000,
    errorComponent,
    loadingComponent
})

const test1 = asyncCom1Fun(() => {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            flagFun(resolve, reject)(import('./components/test2.vue'))
        }, 3000)
    })
})

</script>
<style>
    .test {
      color: red;
    }
</style>
```
