## ä¸€äº›å¸¸ç”¨è‡ªå®šä¹‰æŒ‡ä»¤æ•´ç†

* v-LazyLoad å›¾ç‰‡æ‡’åŠ è½½æŒ‡ä»¤ï¼Œ

  åªåŠ è½½æµè§ˆå™¨å¯è§åŒºåŸŸçš„å›¾ç‰‡

  ```js
  const LazyLoad = {
    // installæ–¹æ³•
    install(Vue, options) {
      const defaultSrc = options.default
      Vue.directive('lazy', {
        bind(el, binding) {
          LazyLoad.init(el, binding.value, defaultSrc)
        },
        inserted(el) {
          if (IntersectionObserver) {
            LazyLoad.observe(el)
          } else {
            LazyLoad.listenerScroll(el)
          }
        },
      })
    },
    // åˆå§‹åŒ–
    init(el, val, def) {
      el.setAttribute('data-src', val)
      el.setAttribute('src', def)
    },
    // åˆ©ç”¨IntersectionObserverç›‘å¬el
    observe(el) {
      var io = new IntersectionObserver((entries) => {
        const realSrc = el.dataset.src
        if (entries[0].isIntersecting) {
          if (realSrc) {
            el.src = realSrc
            el.removeAttribute('data-src')
          }
        }
      })
      io.observe(el)
    },
    // ç›‘å¬scrolläº‹ä»¶
    listenerScroll(el) {
      const handler = LazyLoad.throttle(LazyLoad.load, 300)
      LazyLoad.load(el)
      window.addEventListener('scroll', () => {
        handler(el)
      })
    },
    // åŠ è½½çœŸå®å›¾ç‰‡
    load(el) {
      const windowHeight = document.documentElement.clientHeight
      const elTop = el.getBoundingClientRect().top
      const elBtm = el.getBoundingClientRect().bottom
      const realSrc = el.dataset.src
      if (elTop - windowHeight < 0 && elBtm > 0) {
        if (realSrc) {
          el.src = realSrc
          el.removeAttribute('data-src')
        }
      }
    },
    // èŠ‚æµ
    throttle(fn, delay) {
      let timer
      let prevTime
      return function (...args) {
        const currTime = Date.now()
        const context = this
        if (!prevTime) prevTime = currTime
        clearTimeout(timer)
   
        if (currTime - prevTime > delay) {
          prevTime = currTime
          fn.apply(context, args)
          clearTimeout(timer)
          return
        }
   
        timer = setTimeout(function () {
          prevTime = Date.now()
          timer = null
          fn.apply(context, args)
        }, delay)
      }
    },
  }
   
  export default LazyLoad
  ```

  ä½¿ç”¨ï¼Œå°†ç»„ä»¶å†… æ ‡ç­¾çš„ `src` æ¢æˆ `v-LazyLoad`

  ```html
  <img v-LazyLoad="xxx.jpg" />
  ```

* v-waterMarker ç»™æ•´ä¸ªé¡µé¢æ·»åŠ èƒŒæ™¯æ°´å°

  ```js
function addWaterMarker(str, parentNode, font, textColor) {
    // æ°´å°æ–‡å­—ï¼Œçˆ¶å…ƒç´ ï¼Œå­—ä½“ï¼Œæ–‡å­—é¢œè‰²
    var can = document.createElement('canvas')
    parentNode.appendChild(can)
    can.width = 200
    can.height = 150
    can.style.display = 'none'
    var cans = can.getContext('2d')
    cans.rotate((-20 * Math.PI) / 180)
    cans.font = font || '16px Microsoft JhengHei'
    cans.fillStyle = textColor || 'rgba(180, 180, 180, 0.3)'
    cans.textAlign = 'left'
    cans.textBaseline = 'Middle'
    cans.fillText(str, can.width / 10, can.height / 2)
    parentNode.style.backgroundImage = 'url(' + can.toDataURL('image/png') + ')'
  }
   
  const waterMarker = {
    bind: function (el, binding) {
      addWaterMarker(binding.value.text, el, binding.value.font, binding.value.textColor)
    },
  }
   
  export default waterMarker
  ```
  
  ä½¿ç”¨ï¼Œè®¾ç½®æ°´å°æ–‡æ¡ˆï¼Œé¢œè‰²ï¼Œå­—ä½“å¤§å°å³å¯

  ```vue
  <template>
      <div v-waterMarker="{text:'ğŸ®ğŸ®ğŸ®ğŸ®',textColor:'rgba(255, 45, 26, 0.3)'}"></div>
    </template>
  ```

* v-loading åŠ è½½ä¸­æŒ‡ä»¤

  * loading.vue
  
  * ```vue
    <template>
    <div class="loading">
        <div class="loadEffect">
            <span
                  v-for="(item, index) in list"
                  :key='index'
                  :class='`loading-item loading-${index}`'>
                {{item}}
        </span>
        </div>
        </div>
    </template>
    <script>
        export default {
            name: 'loading',
            props: {
                showModal: {
                    type: Boolean,
                    default: false
                }
            },
            setup (props) {
                return {
                    list: [
                        'ğŸ®', 'ğŸ´', 'ğŸ®', 'ğŸ´', 'ğŸ®', 'ğŸ´', 'ğŸ®', 'ğŸ´'
                    ]
                }
            }
    
        }
    </script>
    
    <style scoped lang="scss">
        $scale: 1; /* æŒ‡å®šç¼©æ”¾å€æ•° */
        .loading{
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            right: 0;
            z-index: 9999;
            background-color: rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .loadEffect{
            width: 100px / $scale;
            height: 100px / $scale;
            position: relative;
            margin: 0 auto;
        }
        .loadEffect span{
            display: inline-block;
            position: absolute;
            -webkit-animation: load 1.04s ease infinite;
        }
        @-webkit-keyframes load{
            0%{
                -webkit-transform: scale(1.2);
                opacity: 1;
            }
            100%{
                -webkit-transform: scale(.3);
                opacity: 0.5;
            }
        }
        .loadEffect span:nth-child(1){
            left: 0;
            top: 50%;
            margin-top:-10px / $scale;
            -webkit-animation-delay:0.13s;
        }
        .loadEffect span:nth-child(2){
            left: 14px / $scale;
            top: 14px / $scale;
            -webkit-animation-delay:0.26s;
        }
        .loadEffect span:nth-child(3){
            left: 50%;
            top: 0;
            margin-left: -10px / $scale;
            -webkit-animation-delay:0.39s;
        }
        .loadEffect span:nth-child(4){
            top: 14px / $scale;
            right:14px / $scale;
            -webkit-animation-delay:0.52s;
        }
        .loadEffect span:nth-child(5){
            right: 0;
            top: 50%;
            margin-top: -10px / $scale;
            -webkit-animation-delay:0.65s;
        }
        .loadEffect span:nth-child(6){
            right: 14px / $scale;
            bottom: 14px / $scale;
            -webkit-animation-delay:0.78s;
        }
        .loadEffect span:nth-child(7){
            bottom: 0;
            left: 50%;
            margin-left: -10px / $scale;
            -webkit-animation-delay:0.91s;
        }
        .loadEffect span:nth-child(8){
            bottom: 14px / $scale;
            left: 14px / $scale;
            -webkit-animation-delay:1.04s;
        }
    </style>
    ```
  
    * loading.js
  
  * ```js
    import { createApp } from 'vue'
    export default function createLoadingLikeDirective (Comp) {
        return {
            mounted (el, binding) {
                const app = createApp(Comp, { showModal: binding.value })
                el.instance = app.mount(document.createElement('div'))
                if (binding.value) {
                    append(el)
                }
            },
            updated (el, binding) {
                if (binding.value !== binding.oldValue) {
                    binding.value ? append(el) : remove(el)
                }
            }
        }
        function append (el) {
            el.appendChild(el.instance.$el)
        }
        function remove (el) {
            el.removeChild(el.instance.$el)
        }
    }
    
    ```
  
  *   å®‰è£…main.js
  
  * ```js
    import loading from './components/loading/loading.vue'
    import createLoadingLikeDirective from './directive/loading'
    const app = createApp(App)
    .directive('loading', createLoadingLikeDirective(loading))
    app.mount('#app')
    ```

* v-clickoutside åˆ¤æ–­å…ƒç´ å¤–ç‚¹å‡»æŒ‡ä»¤

  ```vue
  <template>
    <div v-clickoutside="outsideClick">
      å…ƒç´ å¤–ç‚¹å‡»è¯•è¯•
    </div>	
  </template>
  <script>
    export default {
      directives: {
        clickoutside: { // åˆå§‹åŒ–æŒ‡ä»¤
          bind(el, binding, vnode) {
            function documentHandler(e) {
              // è¿™é‡Œåˆ¤æ–­ç‚¹å‡»çš„å…ƒç´ æ˜¯å¦æ˜¯æœ¬èº«ï¼Œæ˜¯æœ¬èº«ï¼Œåˆ™è¿”å›
              if (el.contains(e.target)) {
                return false;
              }
              // åˆ¤æ–­æŒ‡ä»¤ä¸­æ˜¯å¦ç»‘å®šäº†å‡½æ•°
              if (binding.expression) {
                // å¦‚æœç»‘å®šäº†å‡½æ•° åˆ™è°ƒç”¨é‚£ä¸ªå‡½æ•°ï¼Œæ­¤å¤„binding.valueå°±æ˜¯handleCloseæ–¹æ³•
                binding.value(e);
              }
            }
            // ç»™å½“å‰å…ƒç´ ç»‘å®šä¸ªç§æœ‰å˜é‡ï¼Œæ–¹ä¾¿åœ¨unbindä¸­å¯ä»¥è§£é™¤äº‹ä»¶ç›‘å¬
            el.__vueClickOutside__ = documentHandler;
            document.addEventListener('click', documentHandler);
          },
          update() {},
          unbind(el, binding) { // è§£é™¤äº‹ä»¶ç›‘å¬
            document.removeEventListener('click', el.__vueClickOutside__);
            delete el.__vueClickOutside__;
          }
        }
      },
      methods:{
          outsideClick() {},
      }
    }
  </script>	
  <style lang="scss" scoped></style>
  ```

  