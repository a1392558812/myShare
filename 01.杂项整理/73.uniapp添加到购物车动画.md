# uniapp æ·»åŠ åˆ°è´­ç‰©è½¦åŠ¨ç”»

## ä½¿ç”¨

```html
<template>
  <view>
    <uv-button @click="onAddToBuyCar"> æ·»åŠ åˆ°è´­ç‰©è½¦ </uv-button>
    <AddToBuyCar ref="addToBuyCarRef" />
  </view>
</template>

<script lang="ts" setup>
  import AddToBuyCar from "@/components/add-to-buy-car/index.vue";
  import { ref } from "vue";

  const addToBuyCarRef = ref<InstanceType<typeof AddToBuyCar>>();

  const onAddToBuyCar = () => {
    addToBuyCarRef?.value?.addToBuyCar({
      initPosition: { x: 0, y: 20 },
      finalPosition: { x: 300, y: 500 },
    });
  };
</script>
```

## index.vue

```html
<template>
  <view>
    <view v-if="isAnimating" class="cart-icon" :style="targetStyle">
      <slot>
        <text class="cart-icon-text"> ðŸ›’ </text>
      </slot>
    </view>
  </view>
</template>

<script setup lang="ts">
  import { isNumber } from "@/utils/type-check";
  import { onUnmounted, ref } from "vue";

  interface Position {
    x: number;
    y: number;
  }

  let isH5 = false;

  // #ifdef H5
  isH5 = true;
  // #endif

  // #ifndef H5
  isH5 = false;
  // #endif

  const isAnimating = ref(false);
  const targetStyle = ref<AnyStyleType>({
    left: 0,
    top: 0,
    opacity: 1,
  });

  const requestRef = ref<number | null | ReturnType<typeof setTimeout>>(null);
  const animationFrame = (callback: AnyFunction) => {
    if (isH5) {
      requestRef.value = requestAnimationFrame(() => {
        callback();
      });
    } else {
      requestRef.value = setTimeout(() => {
        callback();
      }, 1000 / 120); // 120å¸§
    }
  };

  const cancelAnimation = () => {
    if (isH5 && isNumber(requestRef.value)) {
      cancelAnimationFrame(requestRef.value!);
    } else if (!isH5 && isNumber(requestRef.value)) {
      clearTimeout(requestRef.value);
    }
  };

  const addToBuyCar = (data: {
    initPosition: Position;
    finalPosition: Position;

    initStyle?: AnyStyleType;
    finalStyle?: AnyStyleType;

    finalShow?: boolean;
    duration?: number;
  }) => {
    cancelAnimation();

    isAnimating.value = true;

    targetStyle.value = {
      left: `${data.initPosition.x}px`,
      top: `${data.initPosition.y}px`,
      ...data.initStyle,
    };

    const startTime = Date.now();
    const startX = data.initPosition.x;
    const startY = data.initPosition.y;
    const endX = data.finalPosition.x;
    const endY = data.finalPosition.y;

    const parabolaHeight = Math.abs(endY - startY) * 0.15;
    const controlY = startY - parabolaHeight;

    const animate = () => {
      const elapsed = Date.now() - startTime;
      const progress = Math.min(elapsed / (data.duration || 700), 1);
      const easedProgress = progress;

      if (progress < 1) {
        const t = easedProgress;
        targetStyle.value.left = `${startX + (endX - startX) * t}px`;
        targetStyle.value.top = `${(1 - t) * (1 - t) * startY + 2 * (1 - t) * t * controlY + t * t * endY}px`;
        animationFrame(animate);
      } else {
        targetStyle.value.left = `${endX}px`;
        targetStyle.value.top = `${endY}px`;
        targetStyle.value = {
          ...targetStyle.value,
          ...data.finalStyle,
        };
        isAnimating.value = false;
        cancelAnimation();
      }
    };

    animationFrame(animate);
  };

  onUnmounted(() => {
    cancelAnimation();
  });
  defineExpose({
    addToBuyCar,
  });
</script>

<style scoped>
  .cart-icon {
    position: fixed;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    z-index: 9999;
    pointer-events: none;
    transition: opacity 0.2s ease-out;
  }

  .cart-icon-text {
    line-height: 1;
  }
</style>
```
