# use-raf 动画帧

- 部分工具函数已经抽取，本人人懒，推荐先看工具函数有无重复代码
  - @/utils/type-check.ts ---> 03.杂项整理/14.类型保护工具函数.md

```typescript
import { isNumber } from "@/utils/type-check";
import { onUnmounted, ref } from "vue";

let isH5 = false;

// #ifdef H5
isH5 = true;
// #endif

// #ifndef H5
isH5 = false;
// #endif

// 定义回调函数类型
type RafCallback = (time: number) => void;

export const useRaf = (callback: RafCallback) => {
  const requestRef = ref<number | null | ReturnType<typeof setTimeout>>(null);

  // 启动动画帧
  const start = () => {
    const handle = (time: number) => {
      callback(time);
    };

    if (isH5) {
      requestRef.value = requestAnimationFrame(handle);
    } else {
      requestRef.value = setTimeout(() => handle(Date.now()), 1000 / 30);
    }
  };

  // 取消动画帧
  const cancel = () => {
    if (isH5 && isNumber(requestRef.value)) {
      cancelAnimationFrame(requestRef.value!);
    } else if (requestRef.value !== null && requestRef.value !== undefined) {
      clearTimeout(requestRef.value);
    }
  };

  onUnmounted(() => {
    cancel();
  });

  return { start, cancel };
};
```
