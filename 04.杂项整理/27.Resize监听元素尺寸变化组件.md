# wd-resize

> æ­¤å¤„å°±æ˜¯å•çº¯çš„æŠŠ wot çš„è¿™ä¸ªç»„ä»¶æºç æå–å‡ºæ¥ï¼Œè¯¦æƒ…æ–‡æ¡£ä¸æºç  ğŸ‘‰ [ã€Resize ç›‘å¬å…ƒç´ å°ºå¯¸å˜åŒ–ã€‘](https://wot-ui.cn/component/resize.html)

// å½“ç»„ä»¶åŒ…è£¹çš„æ–‡æ¡£æµå°ºå¯¸å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§¦å‘ resize äº‹ä»¶ã€‚ä¸€èˆ¬ç”¨äºç›‘å¬ dom å†…å®¹æ›´æ–°æ—¶å¯¼è‡´çš„ dom å°ºå¯¸ä½ç½®çš„å˜åŒ–ï¼Œé‡æ–°è·å– dom å°ºå¯¸å’Œä½ç½®ï¼Œè¿›è¡Œå†…å®¹å±•ç¤ºçš„è®¡ç®—æ“ä½œã€‚

- éƒ¨åˆ†å·¥å…·å‡½æ•°å·²ç»æŠ½å–ï¼Œæœ¬äººäººæ‡’ï¼Œæ¨èå…ˆçœ‹å·¥å…·å‡½æ•°æœ‰æ— é‡å¤ä»£ç 
  - @/utils/components-tools.ts ---> 04.æ‚é¡¹æ•´ç†/35.components-tools.md
  - @/hooks/use-comp-relation.ts ---> 04.æ‚é¡¹æ•´ç†/36.use-comp-relation.md
  - @/utils/type-check.ts ---> 03.æ‚é¡¹æ•´ç†/14.ç±»å‹ä¿æŠ¤å·¥å…·å‡½æ•°.md
  - @/components/transition/index.vue ---> 07.uniapp çš„è‡ªå®šä¹‰ Transition è¿‡æ¸¡ç»„ä»¶.md

## ä½¿ç”¨1ï¼š ç›‘å¬çš„slotçš„å®½é«˜ä¸ç¡®å®šï¼Œæ˜¯ç»§æ‰¿çˆ¶å®¹å™¨çš„

```html
<template>
  <view>
    <uv-number-box v-model.number="boxRect.width" placeholder="è¯·è¾“å…¥å®½åº¦" />
    <uv-number-box v-model.number="boxRect.height" placeholder="è¯·è¾“å…¥é«˜åº¦" />
    <view
      class="bg-[pink]"
      :style="{
        width: `${boxRect.width}px`,
        height: `${boxRect.height}px`,
      }"
    >
      <Resize
        :custom-style="{ width: '100%', height: '100%', position: 'relative' }"
        :custom-container-style="{ left: '0', top: '0', right: '0', bottom: '0' }"
        @resize="onResize"
      >
        <view class="h-full w-full"> 123 </view>
      </Resize>
    </view>
  </view>
</template>

<script setup lang="ts">
  import Resize from "@/components/resize/index.vue";
  import { reactive } from "vue";

  const boxRect = reactive({
    width: 200,
    height: 200,
  });

  const onResize = (resize: AnyObject) => {
    console.log("onResize", resize);
  };
</script>
```

## ä½¿ç”¨2ï¼š ç›‘å¬çš„slotçš„å®½é«˜æ˜¯ç‹¬ç«‹å˜åŒ–çš„ï¼Œè€Œä¸æ˜¯ç»§æ‰¿çˆ¶å®¹å™¨çš„

```html
<template>
  <view>
    <uv-number-box v-model.number="boxRect.width" placeholder="è¯·è¾“å…¥å®½åº¦" />
    <uv-number-box v-model.number="boxRect.height" placeholder="è¯·è¾“å…¥é«˜åº¦" />
    <Resize @resize="onResize">
      <view
        class="bg-[pink]"
        :style="{ height: `${boxRect.height}px`, width: `${boxRect.width}px` }"
      >
        123
      </view>
    </Resize>
  </view>
</template>

<script setup lang="ts">
  import Resize from "@/components/resize/index.vue";
  import { reactive } from "vue";

  const boxRect = reactive({
    width: 200,
    height: 200,
  });

  const onResize = (resize: AnyObject) => {
    console.log("onResize", resize);
  };
</script>
```

## ç»„ä»¶

```html
<template>
  <view class="custom-resize" :style="rootStyle">
    <!-- æ’æ§½éœ€è¦è„±ç¦»çˆ¶å®¹å™¨æ–‡æ¡£æµï¼Œé˜²æ­¢çˆ¶å®¹å™¨å›ºå®½å›ºé«˜ï¼Œè¿›è€Œå¯¼è‡´æ’æ§½å¤§å°è¢«è¢«çˆ¶å®¹å™¨é™åˆ¶ -->
    <view
      :id="resizeId"
      class="custom-resize-container"
      :style="customContainerStyle"
    >
      <!-- è¢«ç›‘å¬çš„æ’æ§½ -->
      <slot />
      <!-- ç›‘å¬æ’æ§½å˜å¤§ -->
      <scroll-view
        class="custom-resize-wrapper"
        :scroll-y="true"
        :scroll-top="expandScrollTop"
        :scroll-x="true"
        :scroll-left="expandScrollLeft"
        @scroll="onScrollHandler"
      >
        <view
          class="custom-resize-wrapper-placeholder"
          style="height: 100000px; width: 100000px"
        />
      </scroll-view>
      <!-- ç›‘å¬æ’æ§½å˜å° -->
      <scroll-view
        class="custom-resize-wrapper"
        :scroll-y="true"
        :scroll-top="shrinkScrollTop"
        :scroll-x="true"
        :scroll-left="shrinkScrollLeft"
        @scroll="onScrollHandler"
      >
        <view
          class="custom-resize-wrapper-placeholder"
          style="height: 250%; width: 250%"
        />
      </scroll-view>
    </view>
  </view>
</template>

<script lang="ts" setup>
  import { getUuid } from "@/utils/components-tools";
  import { computed, getCurrentInstance, onMounted, ref } from "vue";

  interface AnyStyleType {
    [key: string]: string | number;
  }

  export interface ResizeType {
    customStyle?: AnyStyleType;
    customContainerStyle?: AnyStyleType;
  }

  defineOptions({
    virtualHost: true,
    addGlobalClass: true,
    styleIsolation: "shared",
  });

  const props = withDefaults(defineProps<ResizeType>(), {
    customContainerStyle: () => ({}),
    customStyle: () => ({}),
  });
  const emit = defineEmits(["resize"]);

  const expandScrollTop = ref<number>(0);
  const shrinkScrollTop = ref<number>(0);
  const expandScrollLeft = ref<number>(0);
  const shrinkScrollLeft = ref<number>(0);
  const height = ref<number>(0);
  const width = ref<number>(0);
  const scrollEventCount = ref<number>(0);

  const rootStyle = computed(() => {
    const style: AnyStyleType = {
      width: `${width.value}px`,
      height: `${height.value}px`,
    };
    return Object.assign(style, props.customStyle);
  });
  let onScrollHandler = () => {};
  const { proxy } = getCurrentInstance() as any;

  const resizeId = ref<string>(`resize${getUuid()}`);

  const scrollToBottom = ({
    lastWidth,
    lastHeight,
  }: {
    lastWidth: number;
    lastHeight: number;
  }) => {
    expandScrollTop.value = 100000 + lastHeight;
    shrinkScrollTop.value = 3 * height.value + lastHeight;
    expandScrollLeft.value = 100000 + lastWidth;
    shrinkScrollLeft.value = 3 * width.value + lastWidth;
  };

  onMounted(() => {
    // åˆå§‹åŒ–æ•°æ®è·å–
    const query = uni
      .createSelectorQuery()
      .in(proxy)
      .select(`#${resizeId.value}`)
      .boundingClientRect();
    query.exec(([res]) => {
      // é—­åŒ…è®°å½•å®¹å™¨é«˜åº¦
      let lastHeight = res.height;
      let lastWidth = res.width;
      // ç«‹å³å¡«å……çˆ¶å®¹å™¨é«˜å®½
      height.value = lastHeight;
      width.value = lastWidth;
      // ç›‘å¬æ»šåŠ¨äº‹ä»¶
      onScrollHandler = () => {
        const query = uni
          .createSelectorQuery()
          .in(proxy)
          .select(`#${resizeId.value}`)
          .boundingClientRect();
        query.exec(([res]) => {
          // å‰ä¸¤æ¬¡æ»šåŠ¨äº‹ä»¶è¢«è§¦å‘ï¼Œè¯´æ˜ created çš„ä¿®æ”¹å·²æ¸²æŸ“ï¼Œé€šçŸ¥ç”¨æˆ·ä»£ç å½“å‰å®¹å™¨å¤§å°
          if (scrollEventCount.value++ === 0) {
            const result: Record<string, string | number> = {};
            ["bottom", "top", "left", "right", "height", "width"].forEach(
              (propName) => {
                result[propName] = res[propName];
              },
            );
            emit("resize", result);
          }
          // æ»šåŠ¨æ¡æ‹‰åˆ°åº•éƒ¨ä¼šè§¦å‘ä¸¤æ¬¡å¤šä½™çš„äº‹ä»¶ï¼Œå±è”½æ‰ã€‚
          if (scrollEventCount.value < 3) return;
          // æ‰‹åŠ¨è®¾ç½®çˆ¶å®¹å™¨é«˜å®½ï¼Œé˜²æ­¢çˆ¶å®¹å™¨åå¡Œ
          // æ»šåŠ¨å®Œï¼Œé‡æ–°è·å–å®¹å™¨æ–°çš„é«˜åº¦
          const newHeight = res.height;
          const newWidth = res.width;
          // ç«‹å³å¡«å……çˆ¶å®¹å™¨é«˜å®½
          height.value = newHeight;
          width.value = newWidth;
          // å®½é«˜éƒ½æ”¹å˜æ—¶ï¼Œåªéœ€è¦è§¦å‘ä¸€æ¬¡ size äº‹ä»¶
          const emitStack: number[] = [];
          if (newHeight !== lastHeight) {
            lastHeight = newHeight;
            emitStack.push(1);
          }
          if (newWidth !== lastWidth) {
            lastWidth = newWidth;
            emitStack.push(1);
          }
          if (emitStack.length !== 0) {
            const result: Record<string, any> = {};
            ["bottom", "top", "left", "right", "height", "width"].forEach(
              (propName) => {
                result[propName] = res[propName];
              },
            );
            emit("resize", result);
          }
          // æ»šåŠ¨æ¡æ‹‰åˆ°åº•éƒ¨ï¼ˆå¦‚æœä½¿ç”¨ nextTick æ•ˆæœæ›´ä½³ï¼‰
          scrollToBottom({
            lastWidth,
            lastHeight,
          });
        });
      };
      // æ»šåŠ¨æ¡æ‹‰åˆ°åº•éƒ¨ï¼ˆå¦‚æœä½¿ç”¨ nextTick æ•ˆæœæ›´ä½³ï¼‰
      scrollToBottom({
        lastWidth,
        lastHeight,
      });
    });
  });
</script>

<style lang="scss" scoped>
  .custom-resize {
    .custom-resize-container {
      position: absolute;
      min-width: 1px;
      min-height: 1px;
    }

    .custom-resize-wrapper {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: -9999;
      overflow: hidden;
      visibility: hidden;

      .custom-resize-wrapper-placeholder {
        transition: 0s;
        animation: none;
      }
    }
  }
</style>
```
