# vue 中全局 zIndex 管理

## 定义放法

```javascript
class ZIndexManager {
  constructor() {
    // 基础层级配置，按模块划分
    this.baseZIndex = {
      // 基础UI元素
      base: 10,
      // 浮动元素
      float: 100,
      // 下拉菜单
      dropdown: 200,
      // 弹窗
      modal: 300,
      // 提示框
      toast: 400,
      // 加载中
      loading: 500,
      // 置顶元素
      top: 1000,
    };

    // 临时需要显示在最上层的z-index
    this.dynamicIndex = 1000;
  }

  /**
   * 获取基础层级
   * @param {string} key 层级名称
   * @returns {number} 对应的zindex值
   */
  get(key) {
    if (!this.baseZIndex[key]) {
      console.warn(`ZIndexManager: 未定义的层级键 "${key}"`);
      return this.baseZIndex.base;
    }
    return this.baseZIndex[key];
  }

  /**
   * 获取递增的动态层级（用于临时需要显示在最上层的元素）
   * @returns {number} 递增的zIndex值
   */
  getNext() {
    this.dynamicIndex += 1;
    // 防止数值过大溢出，超过阈值后重置
    if (this.dynamicIndex > 10000) {
      this.dynamicIndex = 1000;
    }
    return this.dynamicIndex;
  }

  /**
   * 重置动态层级计数器
   * 调用时机：
   *      1. 页面切换/路由跳转
   *      2. 组件卸载销毁
   *      3. 弹窗关闭
   *      4. 其他需要重置的场景
   */
  resetDynamic() {
    this.dynamicIndex = 1000;
  }

  /**
   * 注册自定义层级
   * @param {Object} customZIndex 自定义层级对象
   * @param {boolean} override 是否覆盖已存在的层级
   */
  register(customZIndex, override = false) {
    Object.keys(customZIndex).forEach((key) => {
      if (!override && this.baseZIndex[key] !== undefined) {
        console.warn(
          `ZIndexManager: 层级键 "${key}" 已存在，使用override=true可覆盖`
        );
        return;
      }
      this.baseZIndex[key] = customZIndex[key];
    });
  }
}

// 创建单例实例
export const zIndexManager = new ZIndexManager();
```

## 基本的组件理使用与注册

```html
<template>
  <div :style="{ zIndex: dropdownZIndex }" class="dropdown">下拉菜单</div>
</template>

<script setup>
  import { zIndexManager } from "@/utils/zIndexManager";
  const dropdownZIndex = zIndexManager.get("dropdown");

  // 注册地图相关层级
  zIndexManager.register({
    mapBase: 50,
    mapMarker: 60,
    mapTooltip: 70,
  });

  console.log(zIndexManager.get("mapMarker")); // 60
</script>
```

```html
<template>
  <drag-float-canvas
    :style="{ zIndex: activeZIndex }"
    class=""
    @click="onTakeToTop"
  >
    点击时置置于顶层
  </drag-float-canvas>
</template>

<script setup>
  import { ref, useTemplateRef } from "vue";
  import { zIndexManager, resetDynamic } from "@/utils/zIndexManager";
  import { onClickOutside } from "@vueuse/core";

  const activeZIndex = ref(zIndexManager.get("float"));
  const target = useTemplateRef("drag-float-canvas");

  // 点击时置于顶层
  const onTakeToTop = () => {
    activeZIndex.value = zIndexManager.getNext();
  };

  // 点击空白处时重置zIndex
  onClickOutside(target, () => {
    activeZIndex.value = zIndexManager.get("float");
    resetDynamic();
  });
</script>
```

// 当然，也可以借助 vuex 或者 pinia 来实现全局的 zIndex 管理,这块就不详细写了，大差不差
