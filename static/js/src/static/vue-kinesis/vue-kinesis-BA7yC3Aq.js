import{a as t,c as e,k as n,r as i,O as s,j as a,s as r}from"../../../@vue-runtime-core-hXVbjtl0.js";var o={props:{type:{type:String,default:"translate"},transformOrigin:{type:String,default:"center"},originX:{type:Number,default:50},originY:{type:Number,default:50},strength:{type:Number,default:10},audioIndex:{type:Number,default:50},axis:{type:String,default:null},maxX:{type:Number,default:null},maxY:{type:Number,default:null},minX:{type:Number,default:null},minY:{type:Number,default:null},cycle:{type:Number,default:0},maxScale:{type:Number,default:-1},minScale:{type:Number,default:-1}},methods:{strengthManager(){return"depth"===this.type||"depth_inv"===this.type?Math.abs(this.strength):this.strength}}},h={name:"KinesisAudio",inject:["context"],mixins:[o],props:{tag:{type:String,default:"div"},audioIndex:{type:Number,default:50}},computed:{transform(){return this.transformAudio()},transformParameters(){return{transitionProperty:"transform",transitionDuration:this.transitionDuration,transformOrigin:this.transformOrigin,transitionTimingFunction:this.transitionTimingFunction}},transitionDuration(){const{duration:t}=this.context;return`${t}ms`},transitionTimingFunction(){return this.context.easing}},methods:{transformAudio(){const{audioData:t}=this.context;if(!this.context.audioData)return;const e=this.type,{strength:n}=this;let i,s;switch(e){case"translate":i=t?t[0][this.audioIndex]:0,s=`translate3d(${i*n}px, 0, 0)`;break;case"rotate":i=t?t[0][this.audioIndex]:0,s=`rotate3d(0,0,1,${i*n/10}deg)`;break;case"scale":i=t?t[0][this.audioIndex]/n<1?1:t[0][this.audioIndex]/(2*n):1,s=`scale(${i})`,-1!==this.maxScale&&i>this.maxScale&&(i/=this.maxScale),-1!==this.minScale&&i<this.minScale&&(i/=this.minScale)}return this.$emit("up-context",this.context),{transform:s}}}};function l(){try{return/Mobi|Android/i.test(navigator.userAgent)}catch(t){return!0}}function u(t,e){return{x:t,y:e}}function d(t){const{target:e,event:n}=t,i=n.clientX,s=n.clientY,a=i-e.left,r=s-e.top,o=u((h=e)?h.width/2:0,h?h.height/2:0);var h;return{...u(a/o.x,r/o.y),target:e}}h.render=function(a,r,o,h,l,u){return t(),e(s(o.tag),{style:{...u.transform,...u.transformParameters}},{default:n((()=>[i(a.$slots,"default")])),_:3},8,["style"])};var c={name:"KinesisContainer",mixins:[{props:{active:{type:Boolean,default:!0},duration:{type:Number,default:1e3},easing:{type:String,default:"cubic-bezier(0.23, 1, 0.32, 1)"},tag:{type:String,default:"div"}}},{props:{perspective:{type:Number,default:1e3}},computed:{style(){return{perspective:`${this.perspective}px`}}}},{props:{audio:{type:String,required:!1},playAudio:{type:Boolean,default:!1}},data:()=>({analyser:null,audioArray:null,audioData:null,audioRef:null,wasPlayed:!1,isPlaying:!1}),watch:{audio(){this.wasPlayed=!1,this.isPlaying=!1},playAudio(t){t?this.play():this.stop()}},methods:{play(){this.active&&(this.wasPlayed||(this.handleAudio(),this.wasPlayed=!0),this.isPlaying=!0,this.audioRef.play(),this.getSongData())},stop(){this.isPlaying=!1,this.audioRef.pause()},handleAudio(){const{audio:t}=this.$refs;this.audioRef=t;const e=new AudioContext,n=e.createMediaElementSource(t),i=e.createAnalyser();n.connect(i),i.connect(e.destination),i.fftSize=256;const s=i.frequencyBinCount,a=new Uint8Array(s);this.audioArray=a,this.analyser=i},getSongData(){this.isPlaying&&(this.analyser.getByteFrequencyData(this.audioArray),this.audioData=new Array(this.audioArray),requestAnimationFrame(this.getSongData))}}},{props:{event:{type:String,default:"move"}},data:()=>({eventMap:{orientation:"deviceorientation",scroll:"scroll",move:l()?"deviceorientation":null}}),methods:{addEvents(){this.eventMap[this.event]&&window.addEventListener(this.eventMap[this.event],this.handleMovement,!0)},removeEvents(){this.eventMap[this.event]&&window.removeEventListener(this.eventMap[this.event],this.handleMovement,!0)}},watch:{event(t,e){this.eventMap[t]&&window.addEventListener(this.eventMap[t],this.handleMovement,!0),this.eventMap[e]&&window.addEventListener(this.eventMap[e],this.handleMovement,!0)}}}],provide(){const t={};return["audioData","duration","easing","event","eventData","isMoving","movement","shape"].forEach((e=>Object.defineProperty(t,e,{enumerable:!0,get:()=>this[e]}))),{context:t}},data:()=>({movement:{x:0,y:0},isMoving:!1,shape:null,leftOnce:!1,eventData:{x:0,y:0}}),mounted(){this.addEvents()},beforeUnmount(){this.removeEvents()},methods:{handleMovement:function(t,e,n){let i,s;return function(){const a=this;let r;r="scroll"===n||a.duration>1e3?e:a.duration/10;const o=+new Date,h=arguments;i&&o<i+r?(clearTimeout(s),s=setTimeout((()=>{requestAnimationFrame((()=>{i=o,t.apply(a,h)}))}),r)):requestAnimationFrame((()=>{i=o,t.apply(a,h)}))}}((function(t){if(!this.active)return;this.isMoving||this.leftOnce||(this.isMoving=!0),this.shape=this.$el.getBoundingClientRect();const e=(n=this.shape).bottom>=0&&n.right>=0&&n.top<=(window.innerHeight||document.documentElement.clientHeight)&&n.left<=(window.innerWidth||document.documentElement.clientWidth);var n,i;"move"===this.event&&this.isMoving&&!l()?(this.movement=d({target:this.shape,event:t}),this.eventData=u(t.clientX,t.clientY)):("orientation"===this.event||"move"===this.event&&l())&&e?this.movement=function(t){const{event:e,target:n}=t;return{...u(e.gamma/45,e.beta/90),target:n}}({target:this.shape,event:t}):"scroll"===this.event&&e&&this.shape.height&&(this.movement={...u(((i=this.shape).left-window.innerWidth)/(i.width+window.innerWidth),(i.top-window.innerHeight)/(i.height+window.innerHeight)),target:i})}),100),handleMovementStart(){this.active&&(this.isMoving=!0)},handleMovementStop(){this.active&&(this.leftOnce=!0,this.isMoving=!1)}}};function m(t){const{y:e,x:n,target:i,originX:s=50,strength:a=10,event:r=null}=t;let{originY:o=50}=t;"scroll"===r&&(o=-o/2);return{...u((n-s/50)*a,(e-o/50)*a),target:i}}function p(t,e,n){return n&&t>n?n:e&&t<e?e:t}function g(t){const{referencePosition:e,elementPosition:n,spanningRange:i,cycles:s}=t,a=(e-n)*(2*Math.PI)/i;return i*Math.sin(a*s)/(i/2)}c.render=function(o,h,l,u,d,c){return t(),e(s(o.tag),{onMousemove:c.handleMovement,onMouseenter:c.handleMovementStart,onMouseleave:c.handleMovementStop,style:o.style},{default:n((()=>[i(o.$slots,"default"),o.audio?(t(),e("audio",{key:0,type:"audio/mpeg",onEnded:h[1]||(h[1]=(...t)=>o.stop&&o.stop(...t)),ref:"audio"},[a("source",{src:o.audio},null,8,["src"])],544)):r("",!0)])),_:3},8,["onMousemove","onMouseenter","onMouseleave","style"])};var v={name:"KinesisElement",mixins:[o,{methods:{transformSwitch(t,e,n,i){let s;switch(t){case"translate":s=this.translateMovement(e,n);break;case"rotate":s=this.rotateMovement(e,n);break;case"depth":s=this.depthMovement(e,n,i);break;case"depth_inv":s=this.depthMovement(-e,-n,i);break;case"scale":s=this.scaleMovement(e,n)}return s},translateMovement:(t,e)=>`translate3d(${-t}px, ${-e}px, 0)`,rotateMovement(t,e){let n;return this.axis?"x"===this.axis?n=2*t:"y"===this.axis&&(n=2*e):n=t+e,`rotate3d(0,0,1,${n}deg)`},depthMovement:(t,e,n)=>`rotateX(${-e}deg) rotateY(${t}deg) translate3d(0,0,${2*n}px)`,scaleMovement(t,e){const{type:n}=this;let i=Math.sign(this.strength)*(Math.abs(t)+Math.abs(e))/10+1;return-1!==this.maxScale&&i>this.maxScale&&(i/=this.maxScale),-1!==this.minScale&&i<this.minScale&&(i/=this.minScale),`scale3d(${"scaleX"===n||"scale"===n?i:1},\n            ${"scaleY"===n||"scale"===n?i:1},\n            1)`}}}],inject:["context"],props:{tag:{type:String,default:"div"}},computed:{transform(){return this.transformMovement()},getContext(){return this.context},transformParameters(){return{transitionProperty:"transform",transitionDuration:this.transitionDuration,transformOrigin:this.transformOrigin,transitionTimingFunction:this.transitionTimingFunction}},transitionDuration(){const{duration:t}=this.context;return`${t}ms`},transitionTimingFunction(){return this.context.easing},isTouch:()=>l()},methods:{transformMovement(){const{context:t}=this;if(!t.isMoving&&"move"===t.event)return{};let e,n;const i=t.event,s=this.strengthManager();if(this.cycle<=0){const{x:a,y:r}=m({...t.movement,originX:this.originX,originY:this.originY,strength:s}),o="scroll"===i;if(o||(e="y"===this.axis?0:p(a,this.minX,this.maxX),n="x"===this.axis?0:p(r,this.minY,this.maxY)),o){const i=m({x:t.movement.x,y:t.movement.y,originX:this.originX,originY:this.originY,strength:s,event:t.event}).y;e="x"===this.axis?i:0,n="y"!==this.axis&&this.axis?0:i}}else if(this.cycle>0){const{shape:a,eventData:r}=t;if(a){e=("x"===this.axis?g({referencePosition:"scroll"===i?0:r.x,elementPosition:a.left,spanningRange:"scroll"===i?window.innerWidth:a.width,cycles:this.cycle}):0)*s,n=("y"!==this.axis&&this.axis?0:g({referencePosition:"scroll"===i?0:r.y,elementPosition:a.top,spanningRange:"scroll"===i?window.innerHeight:a.height,cycles:this.cycle}))*s}}let a=this.type;a="scaleX"===a||"scaleY"===a?"scale":a;return{transform:this.transformSwitch(a,e,n,this.strength)}}}};v.render=function(a,r,o,h,l,u){return t(),e(s(o.tag),{style:{...u.transform,...u.transformParameters}},{default:n((()=>[i(a.$slots,"default")])),_:3},8,["style"])};export{h as a,v as b,c as s};
