import{w as e}from"../../../../../@vue-runtime-dom-CmJM4nE0.js";import{S as t,h as n,P as o,W as i,O as a,A as s,D as r,G as d,a as l,i as p,c,B as h}from"../../../../../three-DmcQ_-qn.js";import{g as w}from"../../../../../gsap-B1fsDziV.js";import{r as m}from"../../../../../@vue-reactivity-v2zUdFSg.js";import{o as v,y as u,g as x,a as g,l as f,P as _,s as y,n as b}from"../../../../../@vue-runtime-core-DQcPG1cz.js";import{k}from"../../../../../@vue-shared-C0QUMStP.js";const E={class:"absolute top-[20px] left-[0] right-[0] text-center text-[white] z-10"},W={class:"text-[24px] [font-weight:bold] m-[5px] [text-shadow:2px_2px_4px_rgba(0,_0,_0,_0.5)]"},z={class:"text-[24px] [font-weight:bold] m-[5px] [text-shadow:2px_2px_4px_rgba(0,_0,_0,_0.5)]"},j={key:0,class:"text-[18px] mt-[10px] opacity-80"},M={key:1,class:"bg-[rgba(0,_0,_0,_0.8)] p-[30px] rounded-[15px] [box-shadow:0_10px_30px_rgba(0,_0,_0,_0.5)]"},L=f("div",{class:"text-[36px] [font-weight:bold] text-[#ff6b6b] mb-[15px]"},"游戏结束!",-1),H={class:"text-[24px] mb-[20px]"},I={__name:"index",setup(I){const O=m(),S=m(0),X=m(1),A=m(!1);let D,P,C,F,q,B,G,R,Z=.02,J=1;const K={positionX:0,halfWidth:2},N=()=>{const e=new h(4,1,4),t=new p({color:16739179,roughness:.5,metalness:.2}),n=new c(e,t);n.position.y=0,q.add(n),Q()},Q=()=>{const e=new h(4,1,4),t=[15698795,5164484,4569041,9883316,16771751,14673641],n=t[Math.floor(Math.random()*t.length)],o=new p({color:n,roughness:.5,metalness:.2,transparent:!0,opacity:.8});if(B=new c(e,o),B.position.y=1*q.children.length+.5+.02,B.position.x=-6,D.add(B),J=1,q.children.length>0){const e=q.children[q.children.length-1],t=e.geometry;K.positionX=e.position.x,K.halfWidth=t.parameters.width/2}else K.positionX=0,K.halfWidth=.5},T=()=>{A.value||V()},U=e=>{A.value||"Space"===e.code&&V()},V=()=>{if(!B)return;let e=!0;if(q.children.length>0){const t=q.children[q.children.length-1],n=t.geometry.parameters.width,o=n/2,i=B.position.x,a=t.position.x,s=2,r=i-s,d=i+s,l=a-o,w=a+o,m=Math.max(r,l),v=Math.min(d,w);if(m>=v)return e=!1,void te();const u=v-m,x=(m+v)/2,g=Math.min(u,n),f=new h(g,1,4),_=new p({color:B.material.color,roughness:.5,metalness:.2}),y=new c(f,_);y.position.x=x,y.position.y=B.position.y,y.position.z=0,D.remove(B),q.add(y),B=y}else{const e=B.material;e.transparent=!1,e.opacity=1,D.remove(B),q.add(B)}if(e){S.value++,S.value%5==0&&(X.value++,Z+=.01);const e=q.children.length,t=6+.8*e,n=15+.5*e,o=1*e+2;w.to(P.position,{y:t,z:n,duration:.5,ease:"power2.inOut"}),w.to(F.target,{y:o,duration:.5,ease:"power2.inOut"}),F.update(),Q()}},Y=()=>{R=window.setInterval((()=>{if(!A.value&&B)if(B.position.x+=Z*J,J>0){const e=B.geometry.parameters.width/2,t=B.position.x+e,n=K.positionX+K.halfWidth;if(t>n){const e=t-n;B.position.x-=e,J=-1}}else B.position.x<-6&&(B.position.x=-6,J=1)}),16)},$=()=>{G=requestAnimationFrame($),F.update(),C.render(D,P)},ee=()=>{O.value&&(P.aspect=window.innerWidth/window.innerHeight,P.updateProjectionMatrix(),C.setSize(window.innerWidth,window.innerHeight))},te=()=>{A.value=!0,clearInterval(R),B&&(D.remove(B),B=void 0)},ne=()=>{for(clearInterval(R),S.value=0,X.value=1,Z=.02,J=1,K.positionX=0,K.halfWidth=2;q.children.length>0;){const e=q.children[0];q.remove(e)}B&&(D.remove(B),B=void 0),b((()=>{A.value=!1,w.to(P.position,{y:6,z:15,duration:.5,ease:"power2.inOut"}),w.to(F.target,{y:0,duration:.5,ease:"power2.inOut"}),F.update(),N(),Y()}))};return v((()=>{(async()=>{if(await b(),!O.value)return;D=new t,D.background=new n(1710638),P=new o(65,window.innerWidth/window.innerHeight,.1,1e3),P.position.set(0,6,15),P.lookAt(0,0,0),C=new i({antialias:!0}),C.setSize(window.innerWidth,window.innerHeight),O.value.appendChild(C.domElement),F=new a(P,C.domElement),F.enableDamping=!0,F.dampingFactor=.1,F.enableZoom=!0,F.zoomSpeed=.5,F.minDistance=5,F.maxDistance=20;const e=new s(16777215,.5);D.add(e);const h=new r(16777215,.8);h.position.set(5,10,7.5),D.add(h),q=new d,D.add(q);const w=new l(15,15),m=new p({color:3355443,roughness:.8}),v=new c(w,m);v.rotation.x=-Math.PI/2,v.position.y=-.5,D.add(v),N(),window.addEventListener("resize",ee),O.value.addEventListener("click",T),window.addEventListener("keydown",U),Y(),$()})()})),u((()=>{G&&cancelAnimationFrame(G),clearInterval(R),O.value&&(O.value.removeEventListener("click",T),C&&C.domElement&&O.value.contains(C.domElement)&&O.value.removeChild(C.domElement)),window.removeEventListener("resize",ee),window.removeEventListener("keydown",U),F&&F.dispose(),C&&C.dispose()})),(t,n)=>(g(),x("div",{class:"w-screen h-screen relative overflow-hidden flex items-center justify-center bg-[linear-gradient(135deg,_#1a1a2e_0%,_#16213e_100%)]",ref_key:"containerRef",ref:O},[f("div",E,[f("div",W,"得分: "+k(S.value),1),f("div",z,"关卡: "+k(X.value),1),_(" "+k(A.value)+" ",1),A.value?y("",!0):(g(),x("div",j,"点击或按空格键堆叠方块")),A.value?(g(),x("div",M,[L,f("div",H,"最终得分: "+k(S.value),1),f("button",{class:"bg-[#4ecdc4] text-[white] border-none px-[30px] py-[15px] text-[18px] rounded-[30px] cursor-pointer [transition:all_0.3s_ease] [font-weight:bold] hover:bg-[#45b7d1] hover:scale-105",onClick:e(ne,["prevent","stop"])},"重新开始")])):y("",!0)])],512))}};export{I as default};
