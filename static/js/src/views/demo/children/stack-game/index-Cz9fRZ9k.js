import{w as e}from"../../../../../@vue-runtime-dom-ByoLcAZV.js";import{S as t,h as n,P as o,W as i,O as a,A as s,D as r,G as d,a as l,i as p,c,B as h}from"../../../../../three-3WzKpasE.js";import{g as w}from"../../../../../gsap-B1fsDziV.js";import{r as m}from"../../../../../@vue-reactivity-mdokXGQ5.js";import{o as v,t as u,a as x,g,l as f,P as _,s as b,n as y}from"../../../../../@vue-runtime-core-lkGMyH8G.js";import{k}from"../../../../../@vue-shared-LkD7rn4X.js";const E={class:"absolute top-[20px] left-[0] right-[0] text-center text-[white] z-10"},W={class:"text-[24px] [font-weight:bold] m-[5px] [text-shadow:2px_2px_4px_rgba(0,_0,_0,_0.5)]"},z={class:"text-[24px] [font-weight:bold] m-[5px] [text-shadow:2px_2px_4px_rgba(0,_0,_0,_0.5)]"},j={key:0,class:"text-[18px] mt-[10px] opacity-80"},M={key:1,class:"bg-[rgba(0,_0,_0,_0.8)] p-[30px] rounded-[15px] [box-shadow:0_10px_30px_rgba(0,_0,_0,_0.5)]"},L=f("div",{class:"text-[36px] [font-weight:bold] text-[#ff6b6b] mb-[15px]"},"游戏结束!",-1),I={class:"text-[24px] mb-[20px]"},O={__name:"index",setup(O){const S=m(),X=m(0),A=m(1),D=m(!1);let H,P,C,F,G,q,B,K,R=.02,Z=1;const J={positionX:0,halfWidth:2},N=()=>{const e=new h(4,1,4),t=new p({color:16739179,roughness:.5,metalness:.2}),n=new c(e,t);n.position.y=0,G.add(n),Q()},Q=()=>{const e=new h(4,1,4),t=[15698795,5164484,4569041,9883316,16771751,14673641],n=t[Math.floor(Math.random()*t.length)],o=new p({color:n,roughness:.5,metalness:.2,transparent:!0,opacity:.8});if(q=new c(e,o),q.position.y=1*G.children.length+.5+.02,q.position.x=-6,H.add(q),Z=1,G.children.length>0){const e=G.children[G.children.length-1],t=e.geometry;J.positionX=e.position.x,J.halfWidth=t.parameters.width/2}else J.positionX=0,J.halfWidth=.5},T=()=>{D.value||V()},U=e=>{D.value||"Space"===e.code&&V()},V=()=>{if(!q)return;let e=!0;if(G.children.length>0){const t=G.children[G.children.length-1],n=t.geometry.parameters.width,o=n/2,i=q.position.x,a=t.position.x,s=2,r=i-s,d=i+s,l=a-o,w=a+o,m=Math.max(r,l),v=Math.min(d,w);if(m>=v)return e=!1,void te();const u=v-m,x=(m+v)/2,g=Math.min(u,n),f=new h(g,1,4),_=new p({color:q.material.color,roughness:.5,metalness:.2}),b=new c(f,_);b.position.x=x,b.position.y=q.position.y,b.position.z=0,H.remove(q),G.add(b),q=b}else{const e=q.material;e.transparent=!1,e.opacity=1,H.remove(q),G.add(q)}if(e){X.value++,X.value%5==0&&(A.value++,R+=.01);const e=G.children.length,t=6+.8*e,n=15+.5*e,o=1*e+2;w.to(P.position,{y:t,z:n,duration:.5,ease:"power2.inOut"}),w.to(F.target,{y:o,duration:.5,ease:"power2.inOut"}),F.update(),Q()}},Y=()=>{K=window.setInterval((()=>{if(!D.value&&q)if(q.position.x+=R*Z,Z>0){const e=q.geometry.parameters.width/2,t=q.position.x+e,n=J.positionX+J.halfWidth;if(t>n){const e=t-n;q.position.x-=e,Z=-1}}else q.position.x<-6&&(q.position.x=-6,Z=1)}),16)},$=()=>{B=requestAnimationFrame($),F.update(),C.render(H,P)},ee=()=>{S.value&&(P.aspect=window.innerWidth/window.innerHeight,P.updateProjectionMatrix(),C.setSize(window.innerWidth,window.innerHeight))},te=()=>{D.value=!0,clearInterval(K),q&&(H.remove(q),q=void 0)},ne=()=>{for(clearInterval(K),X.value=0,A.value=1,R=.02,Z=1,J.positionX=0,J.halfWidth=2;G.children.length>0;){const e=G.children[0];G.remove(e)}q&&(H.remove(q),q=void 0),y((()=>{D.value=!1,w.to(P.position,{y:6,z:15,duration:.5,ease:"power2.inOut"}),w.to(F.target,{y:0,duration:.5,ease:"power2.inOut"}),F.update(),N(),Y()}))};return v((()=>{(async()=>{if(await y(),!S.value)return;H=new t,H.background=new n(1710638),P=new o(65,window.innerWidth/window.innerHeight,.1,1e3),P.position.set(0,6,15),P.lookAt(0,0,0),C=new i({antialias:!0}),C.setSize(window.innerWidth,window.innerHeight),S.value.appendChild(C.domElement),F=new a(P,C.domElement),F.enableDamping=!0,F.dampingFactor=.1,F.enableZoom=!0,F.zoomSpeed=.5,F.minDistance=5,F.maxDistance=20;const e=new s(16777215,.5);H.add(e);const h=new r(16777215,.8);h.position.set(5,10,7.5),H.add(h),G=new d,H.add(G);const w=new l(15,15),m=new p({color:3355443,roughness:.8}),v=new c(w,m);v.rotation.x=-Math.PI/2,v.position.y=-.5,H.add(v),N(),window.addEventListener("resize",ee),S.value.addEventListener("click",T),window.addEventListener("keydown",U),Y(),$()})()})),u((()=>{B&&cancelAnimationFrame(B),clearInterval(K),S.value&&(S.value.removeEventListener("click",T),C&&C.domElement&&S.value.contains(C.domElement)&&S.value.removeChild(C.domElement)),window.removeEventListener("resize",ee),window.removeEventListener("keydown",U),F&&F.dispose(),C&&C.dispose()})),(t,n)=>(x(),g("div",{class:"w-screen h-screen relative overflow-hidden flex items-center justify-center bg-[linear-gradient(135deg,_#1a1a2e_0%,_#16213e_100%)]",ref_key:"containerRef",ref:S},[f("div",E,[f("div",W,"得分: "+k(X.value),1),f("div",z,"关卡: "+k(A.value),1),_(" "+k(D.value)+" ",1),D.value?b("",!0):(x(),g("div",j,"点击或按空格键堆叠方块")),D.value?(x(),g("div",M,[L,f("div",I,"最终得分: "+k(X.value),1),f("button",{class:"bg-[#4ecdc4] text-[white] border-none px-[30px] py-[15px] text-[18px] rounded-[30px] cursor-pointer [transition:all_0.3s_ease] [font-weight:bold] hover:bg-[#45b7d1] hover:scale-105",onClick:e(ne,["prevent","stop"])},"重新开始")])):b("",!0)])],512))}};export{O as default};
