import{v as l}from"../../../../../@vue-runtime-dom-ByoLcAZV.js";import{_ as e}from"../../../../../plugin-vue_export-helper-BCo6x5W8.js";import{r,a as o}from"../../../../../@vue-reactivity-mdokXGQ5.js";import{b as a,a as n,g as t,l as u,F as c,q as s,m as i,P as d,x as p,y}from"../../../../../@vue-runtime-core-lkGMyH8G.js";import{l as v,n as b,k as f}from"../../../../../@vue-shared-LkD7rn4X.js";const h={class:"flex gap-[20px] p-[20px]"},x={class:"p-[10px] rounded-[20px] bg-[#eee]"},k=["onClick"],g={class:"w-[10px] h-[10px] bg-[#090] rounded-full absolute z-[10]"},m={class:"p-[20px] text-[18px] lh-[1.5]"},j=(l=>(p("data-v-0add24cf"),l=l(),y(),l))((()=>u("br",null,null,-1))),O={class:"controls"},M=["disabled"],C=e(Object.assign({name:"chess-board"},{__name:"index",setup(e){const p=r("red"),y=r(null),C=r("进行中"),J={king:{red:"帥",black:"將"},guard:{red:"仕",black:"士"},elephant:{red:"相",black:"象"},horse:{red:"傌",black:"馬"},chariot:{red:"俥",black:"車"},cannon:{red:"炮",black:"砲"},soldier:{red:"兵",black:"卒"}},N=[[{type:"chariot",color:"black"},{type:"horse",color:"black"},{type:"elephant",color:"black"},{type:"guard",color:"black"},{type:"king",color:"black"},{type:"guard",color:"black"},{type:"elephant",color:"black"},{type:"horse",color:"black"},{type:"chariot",color:"black"}],[null,null,null,null,null,null,null,null,null],[null,{type:"cannon",color:"black"},null,null,null,null,null,{type:"cannon",color:"black"},null],[{type:"soldier",color:"black"},null,{type:"soldier",color:"black"},null,{type:"soldier",color:"black"},null,{type:"soldier",color:"black"},null,{type:"soldier",color:"black"}],[null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null],[{type:"soldier",color:"red"},null,{type:"soldier",color:"red"},null,{type:"soldier",color:"red"},null,{type:"soldier",color:"red"},null,{type:"soldier",color:"red"}],[null,{type:"cannon",color:"red"},null,null,null,null,null,{type:"cannon",color:"red"},null],[null,null,null,null,null,null,null,null,null],[{type:"chariot",color:"red"},{type:"horse",color:"red"},{type:"elephant",color:"red"},{type:"guard",color:"red"},{type:"king",color:"red"},{type:"guard",color:"red"},{type:"elephant",color:"red"},{type:"horse",color:"red"},{type:"chariot",color:"red"}]],S=o(JSON.parse(JSON.stringify(N))),_=r([]),w=r([]),E=a((()=>w.value.length>0)),z=a((()=>(l,e,r)=>{var o,a;const n={};return(null==l?void 0:l.type)&&J[l.type][l.color]&&((null==(o=y.value)?void 0:o.x)===e&&(null==(a=y.value)?void 0:a.y)===r?n.backgroundColor="#9f9":n.backgroundColor="#fff",l&&l.color&&(n.color=l.color,n.border="2px solid #333",n.borderRadius="50%")),n})),A=a((()=>(l,e)=>{if(e<0||e>=S.length)return!1;const r=S[e];if(!Array.isArray(r))return!1;if(l<0||l>=r.length)return!1;const o=S.length-1,a=r.length-1;return 0===l&&0===e?"board-item-left-top":l===a&&0===e?"board-item-right-top":0===l&&e===o?"board-item-left-bottom":l===a&&e===o?"board-item-right-bottom":0===e?"board-item-top-edge":e===o?"board-item-bottom-edge":0===l?"board-item-left-edge":l===a?"board-item-right-edge":""})),$=(l,e,r)=>{const o="red"===r?[7,8,9]:[0,1,2];return[3,4,5].includes(l)&&o.includes(e)},q=()=>{let l=null,e=null;for(let r=0;r<10;r++)for(let o=0;o<9;o++){const a=S[r][o];"king"===(null==a?void 0:a.type)&&("red"===a.color?l={x:o,y:r}:e={x:o,y:r})}if(l&&e&&l.x===e.x){const r=Math.min(l.y,e.y),o=Math.max(l.y,e.y);if(0===((l,e,r,o)=>{if(l!==r&&e!==o)return 0;let a=0;const n=r-l,t=o-e,u=Math.max(Math.abs(n),Math.abs(t)),c=0===n?0:n/Math.abs(n),s=0===t?0:t/Math.abs(t);for(let i=1;i<u;i++){const r=l+c*i;S[e+s*i][r]&&a++}return a})(l.x,r,l.x,o))return!0}return!1},F=(l,e)=>{if("进行中"!==C.value)return;const r=S[e][l];if(y.value){if(_.value.some((r=>r.x===l&&r.y===e))){w.value.push({board:JSON.parse(JSON.stringify(S)),player:p.value});const r=S[e][l];if("king"===(null==r?void 0:r.type))return C.value=`${p.value}方获胜！`,S[e][l]=S[y.value.y][y.value.x],void(S[y.value.y][y.value.x]=null);S[e][l]=S[y.value.y][y.value.x],S[y.value.y][y.value.x]=null,q()||I()?C.value=`${p.value}方获胜！`:p.value="red"===p.value?"black":"red"}y.value=null,_.value=[]}else r&&r.color===p.value&&(y.value={x:l,y:e},_.value=((l,e,r)=>{const o=[],a=(l,e)=>{var o,a;return(null==(a=null==(o=S[e])?void 0:o[l])?void 0:a.color)===r.color};switch(r.type){case"king":[[-1,0],[1,0],[0,-1],[0,1]].forEach((([n,t])=>{const u=l+n,c=e+t;$(u,c,r.color)&&!a(u,c)&&o.push({x:u,y:c})}));break;case"guard":[[-1,-1],[-1,1],[1,-1],[1,1]].forEach((([n,t])=>{const u=l+n,c=e+t;$(u,c,r.color)&&!a(u,c)&&o.push({x:u,y:c})}));break;case"elephant":[[-2,-2],[-2,2],[2,-2],[2,2]].forEach((([n,t])=>{var u;const c=l+n,s=e+t,i=l+n/2,d=e+t/2;!("red"===r.color?s>=5:s<=4)||(null==(u=S[d])?void 0:u[i])||a(c,s)||o.push({x:c,y:s})}));break;case"horse":[[-1,-2],[-2,-1],[-2,1],[-1,2],[1,2],[2,1],[2,-1],[1,-2]].forEach((([r,n])=>{var t;const u=l+r,c=e+n;let s,i;Math.abs(r)>Math.abs(n)?(s=l+(r>0?1:-1),i=e):(s=l,i=e+(n>0?1:-1)),!a(u,c)&&u>=0&&u<=8&&c>=0&&c<=9&&!(null==(t=S[i])?void 0:t[s])&&o.push({x:u,y:c})}));break;case"chariot":for(const r of[[-1,0],[1,0],[0,-1],[0,1]]){let n=1;for(;;){const t=l+r[0]*n,u=e+r[1]*n;if(t<0||t>8||u<0||u>9)break;if(a(t,u))break;if(o.push({x:t,y:u}),S[u][t])break;n++}}break;case"cannon":for(const r of[[-1,0],[1,0],[0,-1],[0,1]]){let n=1,t=!1;for(;;){const u=l+r[0]*n,c=e+r[1]*n;if(u<0||u>8||c<0||c>9)break;if(S[c][u]){if(t){a(u,c)||o.push({x:u,y:c});break}t=!0}else t||o.push({x:u,y:c});n++}}break;case"soldier":("red"===r.color?e>4?[[0,-1]]:[[0,-1],[-1,0],[1,0]]:e<5?[[0,1]]:[[0,1],[-1,0],[1,0]]).forEach((([r,n])=>{const t=l+r,u=e+n;a(t,u)||o.push({x:t,y:u})}))}return o.filter((l=>l.x>=0&&l.x<=8&&l.y>=0&&l.y<=9&&!a(l.x,l.y)))})(l,e,r))},I=()=>{let l=!1,e=!1;for(let r=0;r<10;r++)for(let o=0;o<9;o++){const a=S[r][o];"king"===(null==a?void 0:a.type)&&("red"===a.color?l=!0:e=!0)}return!l||!e},P=()=>{Object.assign(S,JSON.parse(JSON.stringify(N))),p.value="red",y.value=null,_.value=[],C.value="进行中",w.value=[]},R=()=>{if(!E.value)return;const l=w.value.pop();Object.assign(S,l.board),p.value=l.player,y.value=null,_.value=[],C.value="进行中"};return(e,r)=>(n(),t("div",h,[u("div",x,[(n(!0),t(c,null,s(S,((e,r)=>(n(),t("div",{key:r,class:"flex"},[(n(!0),t(c,null,s(e,((e,o)=>(n(),t("div",{key:o,class:v(["board-item w-[70px] h-[70px] flex justify-center items-center relative cursor-pointer",A.value(o,r)]),onClick:l=>F(o,r)},[u("div",{class:"w-[50px] h-[50px] text-[28px] lh-[1] flex items-center justify-center font-bold absolute z-[10]",style:b(z.value(e,o,r))},f((null==e?void 0:e.type)&&J[e.type][e.color]),5),i(u("view",g,null,512),[[l,_.value.some((l=>l.x===o&&l.y===r))]])],10,k)))),128))])))),128))]),u("div",m,[d(" 当前玩家："+f(p.value),1),j,d(" 游戏状态："+f(C.value)+" ",1),u("div",O,[u("button",{class:"mr-[10px]",onClick:P},"重新开始"),u("button",{onClick:R,disabled:!E.value},"悔棋",8,M)])])]))}}),[["__scopeId","data-v-0add24cf"]]);export{C as default};
