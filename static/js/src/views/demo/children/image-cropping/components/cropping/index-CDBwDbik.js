import{a as e,e as t}from"../../../../../../../@vue-runtime-dom-CmJM4nE0.js";import{M as o}from"../../../../../../../vue-cropper-DCvgF-Tf.js";import{r,a,u as l}from"../../../../../../../@vue-reactivity-v2zUdFSg.js";import{e as s,g as n,a as i,l as p,s as c,j as u,m as g}from"../../../../../../../@vue-runtime-core-DQcPG1cz.js";import{k as d}from"../../../../../../../@vue-shared-C0QUMStP.js";const x={class:"flex flex-col"},b={class:"flex gap-2"},m={class:"bg-white rounded-xl w-[500px] shadow-md p-4 mb-6"},y={class:"w-full aspect-square bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden"},f={key:0,class:"text-center text-gray-500"},h=[p("p",null,"请选择一张图片开始裁剪",-1)],v={key:0,class:"bg-white rounded-xl w-[500px] shadow-md p-6"},w=p("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"裁剪设置",-1),C={class:"space-y-4"},L={class:"flex items-center space-x-2"},j=p("span",{class:"text-gray-700 w-24"},"图片质量:",-1),k={class:"text-gray-600 min-w-12 text-right"},R={class:"flex items-center space-x-2"},S=p("span",{class:"text-gray-700 w-24"},"图片格式:",-1),H=[p("option",{value:"jpg"},"image/jpg",-1),p("option",{value:"png"},"image/png",-1),p("option",{value:"jpeg"},"image/jpeg",-1),p("option",{value:"webp"},"image/webp",-1)],M={class:"flex items-center space-x-2"},W=p("span",{class:"text-gray-700 w-24"},"裁剪框宽：",-1),U={class:"flex items-center space-x-2"},z=p("span",{class:"text-gray-700 w-24"},"裁剪框高：",-1),B={class:"flex items-center space-x-2"},T=p("span",{class:"text-gray-700 w-24"},"缩放比例：",-1),I=p("span",{class:"text-gray-500 text-sm"},"(比例切勿太大，以免卡死)",-1),V={class:"text-gray-600 text-sm p-3 bg-gray-50 rounded-lg"},$={class:"flex flex-wrap gap-3 pt-2"},_={key:1,class:"bg-white rounded-xl w-[500px]"},O={class:"bg-white rounded-xl shadow-md p-6"},q=p("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"裁剪预览",-1),A=["href"],E=["src"],J={class:"mt-4 text-gray-600 text-sm p-3 bg-gray-50 rounded-lg"},N={__name:"index",props:{fileList:{type:Array,default:()=>[]}},emits:["update:fileList"],setup(N,{emit:D}){const F=N,G=r(null),K=a({ifShow:!1,autoCropWidth:200,autoCropHeight:200,cropW:200,cropH:200,outputType:"png",outputSize:100,canMove:!0,canMoveBox:!0,centerBox:!0,autoCrop:!0,imageSize:50,limitMinSize:65,scaling:1}),P=a({path:""});s((()=>F.fileList),((e,t)=>{e&&e.length&&(K.outputType=e[0].type.split("/")[1]||"png")}),{immediate:!0});const Q=e=>{const t=+e.target.value;K.scaling=t<=0?0:t},X=e=>{G.value.getCropBlob((e=>{let t=window.URL.createObjectURL(e),o=new Image;o.src=t,o.onerror=()=>alert("生成图片失败"),o.onload=()=>{let r=document.createElement("canvas");r.width=K.cropW*+K.scaling,r.height=K.cropH*+K.scaling;let a=r.getContext("2d");"image/png"===e.type&&(a.fillStyle="rgba(255, 255, 255, 0)",a.fillRect(0,0,r.width,r.height)),a.drawImage(o,0,0,r.width,r.height),r.toBlob((e=>{window.URL.revokeObjectURL(P.path||""),window.URL.revokeObjectURL(t),o=null,a=null,r=null,e||alert("生成图片失败"),P.path=window.URL.createObjectURL(e)}),e.type,+K.outputSize/100)}}))},Y=e=>{},Z=e=>{K.cropW=G.value.cropW,K.cropH=G.value.cropH},ee=e=>{},te=()=>{let e=+K.cropW,t=+K.cropH;const o=G.value.getImgAxis();o.x1<0&&(o.x1=0),o.x2>500&&(o.x2=500),o.y1<0&&(o.y1=0),o.y2>500&&(o.y2=500);const r=o.x2-o.x1,a=o.y2-o.y1;e>r&&(e=r),t>a&&(t=a),e||(e=0),t||(t=0),G.value.changeCrop(e,t),K.cropW=e,K.cropH=t},oe=()=>{const e=document.createElement("a");e.download=`image.${K.outputType}`,e.href=P.path,e.click()};return(r,a)=>{var s;return i(),n("div",x,[p("div",b,[p("div",m,[p("div",y,[u(l(o),{ref_key:"cropperRef",ref:G,img:N.fileList[0]?N.fileList[0].path:"",info:!1,fixed:!1,fixedNumber:[1,1],autoCropWidth:K.autoCropWidth,autoCropHeight:K.autoCropHeight,autoCrop:K.autoCrop,canMove:K.canMove,canMoveBox:K.canMoveBox,outputSize:1,outputType:K.outputType,centerBox:K.centerBox,limitMinSize:K.limitMinSize,onCropMoving:Y,onImgMoving:ee,onRealTime:Z},null,8,["img","autoCropWidth","autoCropHeight","autoCrop","canMove","canMoveBox","outputType","centerBox","limitMinSize"]),(null==(s=N.fileList[0])?void 0:s.path)?c("",!0):(i(),n("div",f,h))])]),N.fileList[0]&&N.fileList[0].path?(i(),n("div",v,[w,p("div",C,[p("div",L,[j,g(p("input",{type:"range",max:100,min:10,"onUpdate:modelValue":a[0]||(a[0]=e=>K.outputSize=e),class:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"},null,512),[[e,K.outputSize]]),p("span",k,d(+K.outputSize/100),1)]),p("div",R,[S,g(p("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>K.outputType=e),class:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},H,512),[[t,K.outputType]])]),p("div",M,[W,g(p("input",{class:"flex-1 px-3 py-2 border-1 border-solid border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",type:"number","onUpdate:modelValue":a[2]||(a[2]=e=>K.cropW=e),onInput:te},null,544),[[e,K.cropW]])]),p("div",U,[z,g(p("input",{class:"flex-1 px-3 py-2 border-1 border-solid border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",type:"number","onUpdate:modelValue":a[3]||(a[3]=e=>K.cropH=e),onInput:te},null,544),[[e,K.cropH]])]),p("div",B,[T,g(p("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=e=>K.scaling=e),onInput:Q,class:"flex-1 px-3 py-2 border-1 border-solid border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,544),[[e,K.scaling]]),I]),p("div",V," 结果生成图片的宽 x 高："+d(K.cropW*K.scaling)+"px * "+d(K.cropH*K.scaling)+"px ",1),p("div",$,[p("button",{onClick:a[5]||(a[5]=e=>r.$refs.cropperRef.changeScale(-1)),class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"}," 缩小 "),p("button",{onClick:a[6]||(a[6]=e=>r.$refs.cropperRef.changeScale(1)),class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"}," 放大 "),p("button",{onClick:a[7]||(a[7]=e=>r.$refs.cropperRef.rotateLeft()),class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"}," 左旋 "),p("button",{onClick:a[8]||(a[8]=e=>r.$refs.cropperRef.rotateRight()),class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"}," 右旋 "),p("button",{onClick:X,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-sm"}," 确定裁剪 ")])])])):c("",!0),P.path?(i(),n("div",_,[p("div",O,[q,p("a",{class:"block w-full aspect-square bg-gray-50 rounded-lg border-1 border-solid border-gray-200 overflow-hidden hover:shadow-lg transition-shadow",target:"_blank",title:"预览",href:P.path},[p("img",{src:P.path,class:"w-full h-full object-contain"},null,8,E)],8,A),p("div",J," 图片的宽 x 高："+d(K.cropW*K.scaling)+"px * "+d(K.cropH*K.scaling)+"px ",1),p("button",{onClick:oe,class:"w-full mt-4 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium shadow-sm"}," 下载图片 ")])])):c("",!0)])])}}};export{N as _};
