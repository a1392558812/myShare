import{a as e,e as t}from"../../../../../../../@vue-runtime-dom-ByoLcAZV.js";import{M as o}from"../../../../../../../vue-cropper--sbLdHjX.js";import{r as p,a as l,u as a}from"../../../../../../../@vue-reactivity-mdokXGQ5.js";import{e as n,a as i,g as r,l as u,j as c,m as s,P as m,s as g}from"../../../../../../../@vue-runtime-core-lkGMyH8G.js";import{k as d}from"../../../../../../../@vue-shared-LkD7rn4X.js";const v={class:"flex"},h={class:"mr-[20px]"},f={class:"w-[500px] h-[500px]"},x={key:0,class:""},y=u("span",null,"图片质量: ",-1),b=u("span",null,"图片格式: ",-1),C=[u("option",{value:"jpg"},"image/jpg",-1),u("option",{value:"png"},"image/png",-1),u("option",{value:"jpeg"},"image/jpeg",-1),u("option",{value:"webp"},"image/webp",-1)],w=u("span",null,"裁剪框宽：",-1),L=u("span",null,"裁剪框高：",-1),R=u("span",null,"裁剪生成的图片缩放比例：",-1),j=u("span",null,"(比例切勿太大，以免卡死)",-1),k={class:""},S={key:0},H=["href"],M=["src"],W={__name:"index",props:{fileList:{type:Array,default:()=>[]}},emits:["update:fileList"],setup(W,{emit:U}){const z=W,B=p(null),T=l({ifShow:!1,autoCropWidth:200,autoCropHeight:200,cropW:200,cropH:200,outputType:"png",outputSize:100,canMove:!0,canMoveBox:!0,centerBox:!0,autoCrop:!0,imageSize:50,limitMinSize:65,scaling:1}),I=l({path:""});n((()=>z.fileList),((e,t)=>{e&&e.length&&(T.outputType=e[0].type.split("/")[1]||"png")}),{immediate:!0});const V=e=>{const t=+e.target.value;T.scaling=t<=0?0:t},$=e=>{B.value.getCropBlob((e=>{let t=window.URL.createObjectURL(e),o=new Image;o.src=t,o.onerror=()=>alert("生成图片失败"),o.onload=()=>{let p=document.createElement("canvas");p.width=T.cropW*+T.scaling,p.height=T.cropH*+T.scaling;let l=p.getContext("2d");"image/png"===e.type&&(l.fillStyle="rgba(255, 255, 255, 0)",l.fillRect(0,0,p.width,p.height)),l.drawImage(o,0,0,p.width,p.height),p.toBlob((e=>{window.URL.revokeObjectURL(I.path||""),window.URL.revokeObjectURL(t),o=null,l=null,p=null,e||alert("生成图片失败"),I.path=window.URL.createObjectURL(e)}),e.type,+T.outputSize/100)}}))},_=e=>{},O=e=>{T.cropW=B.value.cropW,T.cropH=B.value.cropH},A=e=>{},E=()=>{let e=+T.cropW,t=+T.cropH;const o=B.value.getImgAxis();o.x1<0&&(o.x1=0),o.x2>500&&(o.x2=500),o.y1<0&&(o.y1=0),o.y2>500&&(o.y2=500);const p=o.x2-o.x1,l=o.y2-o.y1;e>p&&(e=p),t>l&&(t=l),e||(e=0),t||(t=0),B.value.changeCrop(e,t),T.cropW=e,T.cropH=t},N=()=>{const e=document.createElement("a");e.download=`image.${T.outputType}`,e.href=I.path,e.click()};return(p,l)=>(i(),r("div",v,[u("div",h,[u("div",f,[c(a(o),{ref_key:"cropperRef",ref:B,img:W.fileList[0]?W.fileList[0].path:"",info:!1,fixed:!1,fixedNumber:[1,1],autoCropWidth:T.autoCropWidth,autoCropHeight:T.autoCropHeight,autoCrop:T.autoCrop,canMove:T.canMove,canMoveBox:T.canMoveBox,outputSize:1,outputType:T.outputType,centerBox:T.centerBox,limitMinSize:T.limitMinSize,onCropMoving:_,onImgMoving:A,onRealTime:O},null,8,["img","autoCropWidth","autoCropHeight","autoCrop","canMove","canMoveBox","outputType","centerBox","limitMinSize"])]),W.fileList[0]&&W.fileList[0].path?(i(),r("div",x,[u("div",null,[y,s(u("input",{type:"range",max:100,min:10,"onUpdate:modelValue":l[0]||(l[0]=e=>T.outputSize=e)},null,512),[[e,T.outputSize]]),m(" "+d(+T.outputSize/100),1)]),u("div",null,[b,s(u("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>T.outputType=e)},C,512),[[t,T.outputType]])]),u("div",null,[w,s(u("input",{class:"mr-[20px]",type:"number","onUpdate:modelValue":l[2]||(l[2]=e=>T.cropW=e),onInput:E},null,544),[[e,T.cropW]])]),u("div",null,[L,s(u("input",{class:"mr-[20px]",type:"number","onUpdate:modelValue":l[3]||(l[3]=e=>T.cropH=e),onInput:E},null,544),[[e,T.cropH]])]),u("div",null,[R,s(u("input",{type:"number","onUpdate:modelValue":l[4]||(l[4]=e=>T.scaling=e),onInput:V},null,544),[[e,T.scaling]]),j]),u("div",null," 结果生成图片的宽 x 高："+d(T.cropW*T.scaling)+"px * "+d(T.cropH*T.scaling)+"px ",1),u("div",k,[u("button",{onClick:l[5]||(l[5]=e=>p.$refs.cropperRef.changeScale(-1)),class:""},"背景图缩小"),u("button",{class:"",onClick:l[6]||(l[6]=e=>p.$refs.cropperRef.changeScale(1))},"背景图放大"),u("button",{onClick:l[7]||(l[7]=e=>p.$refs.cropperRef.rotateLeft())},"背景图左旋"),u("button",{onClick:l[8]||(l[8]=e=>p.$refs.cropperRef.rotateRight())},"背景图右旋"),u("button",{onClick:$},"确定")])])):g("",!0)]),I.path?(i(),r("div",S,[u("a",{class:"block w-[300px] h-[300px] overflow-auto border-[1px] border-solid border-[#000]",target:"_blank",title:"预览",href:I.path},[u("img",{src:I.path,class:"w-full h-full object-contain"},null,8,M)],8,H),u("div",null,[m(" 图片的宽 x 高："+d(T.cropW*T.scaling)+"px * "+d(T.cropH*T.scaling)+"px ",1),u("button",{onClick:N},"下载")])])):g("",!0)]))}};export{W as _};
