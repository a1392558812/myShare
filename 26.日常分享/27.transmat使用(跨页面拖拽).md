## transmatæ‹–æ‹½ä½¿ç”¨

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>transmatä½¿ç”¨</title>
</head>
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<style type="text/css">
  #test1 {
    width: 400px;
    height: 100px;
    border: 1px solid orange;
  }
  #test2 {
    width: 400px;
    height: 100px;
    border: 1px solid yellow;
  }
  #test2.drag-over{
    background: green;
  }
  .drag-active{
    background: skyblue;
  }
  .drag-nothing{
    background: transparent;
  }
</style>
<body>
<script src="https://unpkg.com/transmat/lib/index.umd.js"></script>
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<!--
 transmatä½¿ç”¨ç›®çš„
    - è·¨é¡µé¢å®ç°æ•°æ®äº¤äº’ï¼ˆä¸»è¦åŠŸèƒ½ï¼‰
    - ä¿®æ”¹é»˜è®¤çš„äº¤äº’é€»è¾‘
    - ä¿®æ”¹ä¸€äº›é»˜è®¤æµè§ˆå™¨è¡Œä¸º
å®˜ç½‘ä»‹ç»ï¼šhttps://github.com/google/transmat
é€šè¿‡åˆ©ç”¨DataTransfer APIåŠŸèƒ½å°†æ•°æ®ä¼ è¾“åˆ°åº”ç”¨ç¨‹åºï¼ŒTransmatä½¿æ‚¨çš„webåº”ç”¨ç¨‹åºèƒ½å¤Ÿè¶…è¶Šæµè§ˆå™¨çš„è¾¹ç•Œè¿›è¡Œäº¤äº’ã€‚
è¿™ç§æŠ€æœ¯ä¸IE11ä¹‹åçš„æ‰€æœ‰ç°ä»£æ¡Œé¢æµè§ˆå™¨éƒ½å…¼å®¹ã€‚Transmatå°†å¸®åŠ©æ‚¨è®¾ç½®å¿…è¦çš„æ‹–æ”¾å’Œå¤åˆ¶ç²˜è´´äº¤äº’ï¼Œ
å¹¶å¸®åŠ©æ‚¨ä¼ è¾“ï¼ˆä¼ è¾“å’Œæ¥æ”¶ï¼‰æ•°æ®ã€‚
 -->

<br><br><br><br><br><br><br><br><br>
<h3>åŠŸèƒ½æ¼”ç¤º</h3>
<div id="test1" draggable="true" tabindex="0">ç¾é£Ÿç•Œé‡Œæˆ‘è€å…«</div>
<div id="test2" tabindex="0">è¢«æ‹–æ”¾è¿›å…¥</div>
<div id="editor">
  <p>Hello World!</p>
  <p>
    <span>Some initial </span>
    <strong>bold</strong>
    <span>text</span>
  </p>
  <p>
    ä¹Ÿå¯ä»¥æ‹–åˆ°è¿™é‡Œ
    </br>
  </p>
</div>
<script>
  // åˆ›å»ºä¸€ä¸ªç¼–è¾‘å™¨
  var quill = new Quill('#editor', {
    theme: 'snow'
  });
  const { Transmat, addListeners, TransmatObserver } = transmat;
  const beDraggedDom = document.getElementById("test1")
  const targetDom = document.getElementById("test2")

  // ä¼ è¾“æ•°æ®é€»è¾‘
  addListeners(beDraggedDom, "transmit", (event) => {
    const transmat = new Transmat(event);
    /*
     MIME ç±»å‹ï¼š https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types
      - åª’ä½“ç±»å‹ï¼ˆé€šå¸¸ç§°ä¸º Multipurpose Internet Mail Extensions æˆ– MIME ç±»å‹ ï¼‰æ˜¯ä¸€ç§æ ‡å‡†ï¼Œ
      - ç”¨æ¥è¡¨ç¤ºæ–‡æ¡£ã€æ–‡ä»¶æˆ–å­—èŠ‚æµçš„æ€§è´¨å’Œæ ¼å¼ã€‚å®ƒåœ¨IETF RFC 6838ä¸­è¿›è¡Œäº†å®šä¹‰å’Œæ ‡å‡†åŒ–ã€‚
      - é€šå¸¸æœ‰   text/plain
                text/html
                image/jpeg
                image/png
                audio/mpeg
                audio/ogg
                audio/*
                video/mp4
                application/*
                application/json
                application/javascript
                application/ecmascript
                application/octet-stream
                ç­‰...
  ç‹¬ç«‹ç±»å‹è¡¨æ˜äº†å¯¹æ–‡ä»¶çš„åˆ†ç±»ï¼Œå¯ä»¥æ˜¯å¦‚ä¸‹ä¹‹ä¸€ï¼š
      text
        - è¡¨æ˜æ–‡ä»¶æ˜¯æ™®é€šæ–‡æœ¬ï¼Œç†è®ºä¸Šæ˜¯äººç±»å¯è¯»
        - text/plain, text/html, text/css, text/javascript
      image
        - è¡¨æ˜æ˜¯æŸç§å›¾åƒã€‚ä¸åŒ…æ‹¬è§†é¢‘ï¼Œä½†æ˜¯åŠ¨æ€å›¾ï¼ˆæ¯”å¦‚åŠ¨æ€gifï¼‰ä¹Ÿä½¿ç”¨imageç±»å‹
        - image/gif, image/png, image/jpeg, image/bmp, image/webp, image/x-icon, image/vnd.microsoft.icon
      audio
        - è¡¨æ˜æ˜¯æŸç§éŸ³é¢‘æ–‡ä»¶
        - audio/midi, audio/mpeg, audio/webm, audio/ogg, audio/wav
      video
        - è¡¨æ˜æ˜¯æŸç§è§†é¢‘æ–‡ä»¶
        - video/webm, video/ogg
      application
        - è¡¨æ˜æ˜¯æŸç§äºŒè¿›åˆ¶æ•°æ®
        - application/octet-stream, application/pkcs12, application/vnd.mspowerpoint,
        - application/xhtml+xml, application/xml,  application/pdf
    * */
    transmat.setData({
      "text/plain": "text/plain!!!!!!!!!!!!!!!!!",
      "text/html": `
       <h1>å±±ä¸œèæ³½æ›¹å¿ï¼ï¼ï¼ï¼ï¼ï¼</h1>
       <p>
          <p>ğŸ®ğŸºï¼Œ666</p>
          <a href="https://bilibili.com">æˆ‘æ»´å®è´ï¼ï¼</a>!
       </p>
       <img style="width: 100px;height: 100px;display: block;background: red" src="" border="1" alt="å‡è£…æˆ‘æ˜¯å¼ å›¾ç‰‡"/>
     `,
      "text/uri-list": "https://bilibili.com",
      "application/json": {
        name: "æ›¹å¿ç‰›çš®",
        phone: "11122333",
        food:'ğŸ”ï¼ŒğŸ‹'
      },
    });
  });

  // æ¥å—æ•°æ®é€»è¾‘
  addListeners(targetDom, "receive", (event) => {
    const transmat = new Transmat(event);
    // åˆ¤æ–­æ˜¯å¦å«æœ‰"application/json"ç±»å‹çš„æ•°æ®
    // åŠäº‹ä»¶ç±»å‹æ˜¯å¦ä¸ºdropæˆ–pasteäº‹ä»¶
    if (transmat.hasType("application/json") && transmat.accept() ) {
      const jsonString = transmat.getData("application/json");
      const data = JSON.parse(jsonString);
      console.log('æ¥æ”¶åˆ°data', data)
      targetDom.textContent = jsonString;
    }
  });

  // äº‹ä»¶ç›‘å¬å™¨
  const obs = new TransmatObserver(entries => {
    console.log('entries', entries)
    const myCustomMimeType = 'application/json';
    for (const entry of entries) {
      const transmat = new Transmat(entry.event);
      console.log('transmat', transmat)
      // å°†å¯å“åº”åŒºåŸŸé«˜äº®
      if(transmat.hasType('application/json')) {
        console.log('entry', entry)
        entry.target.classList.toggle('drag-active', entry.isActive); // å½“è¢«æ‹–æ‹½çš„å…ƒç´ æ­£åœ¨æ‹–æ‹½ä¸­æ¿€æ´»
        entry.target.classList.toggle('drag-over', entry.isTarget); // å½“è¢«æ‹–æ‹½çš„å…ƒç´ æ­£åœ¨æ‹–æ‹½ä¸­ä¸”è¿›å…¥ç›®æ ‡åŒºåŸŸ
        if (!entry.isTarget && !entry.isActive) {
          entry.target.classList.remove('drag-active', 'drag-over'); // å½“è¢«æ‹–æ‹½çš„å…ƒç´ æœ€åæ²¡æœ‰è¿›å…¥ç›®æ ‡åŒºåŸŸ
        }
      }
    }
  });
  obs.observe(targetDom);

</script>
</body>
</html>

```