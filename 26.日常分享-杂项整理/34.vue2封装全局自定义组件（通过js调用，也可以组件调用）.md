## é€šè¿‡jsæˆ–é€šè¿‡ç»„ä»¶å½¢å¼è°ƒç”¨ç»„ä»¶

> æˆ‘ä»¬å¹³æ—¶å°è£…ä¸€ä¸ªå…¨å±€ç»„ä»¶ï¼Œä¸€èˆ¬åœ¨main.jsä¸­Vue.component()å…¨å±€æ³¨å†Œè¿™ä¸ªç»„ä»¶å³å¯
>
> ä½†æœ‰æ—¶å€™ï¼Œä¸¾ä¸ªæ —å­ğŸŒ°ï¼Œæ¯”å¦‚æˆ‘ä»¬å°è£…axiosçš„ajaxè¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å“åº”æ‹¦æˆªï¼Œå¯¹æ‰€æœ‰çš„401ï¼ˆæœªç™»å½•ï¼‰çš„å“åº”å¼¹å‡ºä¸€ä¸ªå¼¹çª—æ¥ï¼Œæç¤ºç”¨æˆ·å»ç™»é™†ï¼Œé‚£æˆ‘ä»¬ç¬¬ä¸€ç§æ–¹æ¡ˆæ³¨å†Œå…¨å±€ç»„ä»¶å°±ä¸å¥½ç”¨äº†

åœ¨ä¸€äº›å¼€æºåº“ä¸­ï¼Œæ¯”å¦‚element-uiã€vantç­‰ï¼Œéƒ½æä¾›äº†jsä¸»åŠ¨è°ƒç”¨æ–¹æ³•å’Œç»„ä»¶è°ƒç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬å°±æ‹¿vantä¸¾ä¾‹

**vantçš„dialogå¦‚ä½•å®ç°**

> å…¶ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦æƒ³å®ç°è¿™ä¸ªconfirmå’Œalert
>
> emmmmmå…¶å®ï¼Œvantçš„è¿™ä¸ªå°è£…å¾ˆæ¸…æ™°æ˜äº†äº†ï¼Œæˆ‘ä»¬åªéœ€â€œå€Ÿé‰´â€ä¸€ä¸‹ï¼ˆå…¶å®å°±æ˜¯copyå’Œå°å°ä¿®æ”¹å°±è¡Œï¼‰

```js
import Vue from 'vue';
import VanDialog from './Dialog'; 
import { isServer } from '../utils';

let instance;

function isInDocument(element) {
  return document.body.contains(element);
}

function initInstance() {
  if (instance) { // å¦‚æœå­˜åœ¨å®ä¾‹ï¼Œå°±é”€æ¯è¿™ä¸ªå®ä¾‹ï¼Œé˜²æ­¢é‡å¤åˆ›å»º
    instance.$destroy();
  }
/*
	Vue.extend( options )ä½¿ç”¨åŸºç¡€ Vue æ„é€ å™¨ï¼Œåˆ›å»ºä¸€ä¸ªâ€œå­ç±»â€ã€‚å‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«ç»„ä»¶é€‰é¡¹çš„å¯¹è±¡ã€‚
	ç†è§£ï¼š 1. Vue.extendè¿”å›çš„æ˜¯ä¸€ä¸ªæ‰©å±•å®ä¾‹æ„é€ å™¨ï¼Œä¹Ÿå°±æ˜¯é¢„è®¾äº†éƒ¨åˆ†é€‰é¡¹çš„Vueå®ä¾‹æ„é€ å™¨ã€‚
		  2. å…¶ä¸»è¦ç”¨æ¥æœåŠ¡äºVue.componentï¼Œç”¨æ¥ç”Ÿæˆç»„ä»¶è¿›è¡Œå®ä¾‹åŒ–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡.$mount(element)æ–¹å¼è¿›è¡Œå®ä¾‹åŒ–
		  3. å¯ä»¥ç®€å•çš„ç†è§£ä¸ºå½“åœ¨æ¨¡æ¿ä¸­é‡åˆ°è¯¥ç»„ä»¶åç§°ä½œä¸ºæ ‡ç­¾çš„è‡ªå®šä¹‰å…ƒç´ æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨æ‰©å±•å®ä¾‹æ„é€ å™¨æ¥ç”Ÿäº§ç»„ä»¶å®ä¾‹ï¼Œå¹¶æŒ‚è½½åˆ°è‡ªå®šä¹‰å…ƒç´ ä¸Šã€‚
*/
  instance = new (Vue.extend(VanDialog))({ 
    // æä¾›ä¸€ä¸ªåœ¨é¡µé¢ä¸Šå·²å­˜åœ¨çš„ DOM å…ƒç´ ä½œä¸º Vue å®ä¾‹çš„æŒ‚è½½ç›®æ ‡ã€‚å¯ä»¥æ˜¯ CSS é€‰æ‹©å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª HTMLElement å®ä¾‹ã€‚
    el: document.createElement('div'), 
    // é¿å…åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶ä¸¢å¤±åŠ¨ç”»
    // åˆ›å»ºå®ä¾‹æ—¶ä¼ é€’ props
    propsData: {
      lazyRender: false,
    },
  });
  // ç›‘å¬å½“å‰å®ä¾‹ä¸Šçš„è‡ªå®šä¹‰äº‹ä»¶ã€‚äº‹ä»¶å¯ä»¥ç”± vm.$emit è§¦å‘ã€‚å›è°ƒå‡½æ•°ä¼šæ¥æ”¶æ‰€æœ‰ä¼ å…¥äº‹ä»¶è§¦å‘å‡½æ•°çš„é¢å¤–å‚æ•°ã€‚	
  instance.$on('input', (value) => {
    instance.value = value;
  });
}

function Dialog(options) {
  /* istanbul ignore if */
  if (isServer) {
    return Promise.resolve();
  }

  return new Promise((resolve, reject) => {
    if (!instance || !isInDocument(instance.$el)) {
      initInstance();
    }

    Object.assign(instance, Dialog.currentOptions, options, {
      resolve,
      reject,
    });
  });
}

Dialog.defaultOptions = {
  value: true,
  title: '',
  width: '',
  theme: null,
  message: '',
  overlay: true,
  className: '',
  allowHtml: true,
  lockScroll: true,
  transition: 'van-dialog-bounce',
  beforeClose: null,
  overlayClass: '',
  overlayStyle: null,
  messageAlign: '',
  getContainer: 'body',
  cancelButtonText: '',
  cancelButtonColor: null,
  confirmButtonText: '',
  confirmButtonColor: null,
  showConfirmButton: true,
  showCancelButton: false,
  closeOnPopstate: true,
  closeOnClickOverlay: false,
  callback: (action) => {
    instance[action === 'confirm' ? 'resolve' : 'reject'](action);
  },
};


Dialog.alert = Dialog;

Dialog.confirm = (options) =>
  Dialog({
    showCancelButton: true,
    ...options,
  });

Dialog.close = () => {
  if (instance) {
    instance.value = false;
  }
};

Dialog.setDefaultOptions = (options) => {
  Object.assign(Dialog.currentOptions, options);
};

Dialog.resetDefaultOptions = () => {
  Dialog.currentOptions = { ...Dialog.defaultOptions };
};

Dialog.resetDefaultOptions();

Dialog.install = () => {
  Vue.use(VanDialog);
};

Dialog.Component = VanDialog;
// åŸå‹ä¸ŠæŒ‚è½½ï¼Œå¯ä»¥é€šè¿‡this.$dialogæ–¹å¼è°ƒç”¨
Vue.prototype.$dialog = Dialog;

export default Dialog;

```

æˆ‘ä»¬åªéœ€æ¨¡ä»¿ï¼Œå°±èƒ½å®ç°æˆ‘ä»¬è‡ªå·±çš„å…¨å±€æç¤ºç™»é™†çš„å¼¹çª—

```js
import Vue from 'vue'
import gologin from './gologin.vue'

const GoLogin = {}

GoLogin.install = (Vue) => { // æ³¨å†Œç»„ä»¶ï¼Œå³å…¨å±€æ³¨å†Œï¼Œæˆ‘åœ¨main.jsä¸­é›†ä¸­æ³¨å†Œäº†ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæ³¨é‡Šäº†
  // Vue.component('go-login', gologin)
}
let currentGoLogin // å½“å‰å®ä¾‹

GoLogin.show = function (options) {
  const GoLoginInstance = Vue.extend(gologin)
  const initInstance = () => {
    currentGoLogin = new GoLoginInstance({ showModal: true })
    const GoLoginEl = currentGoLogin.$mount().$el
    document.body.appendChild(GoLoginEl)
    return GoLoginEl
  }
  if (!currentGoLogin) { // å¦‚æœæ²¡æœ‰å®ä¾‹å°±åˆ›å»ºå®ä¾‹
    initInstance()
  }
  function close () { // é‡å†™ç»„ä»¶ä¸­çš„closeæ–¹æ³•
    currentGoLogin.showModal = false
  }
  function confirm () { // é‡å†™ç»„ä»¶ä¸­çš„cofirmæ–¹æ³•ï¼Œå…è®¸æˆ‘ä»¬è‡ªå®šä¹‰è°ƒç”¨ï¼Œé€šè¿‡onConfirmæ¥è‡ªå®šä¹‰è°ƒç”¨
    currentGoLogin.showModal = false
    currentGoLogin.onConfirm && currentGoLogin.onConfirm() // æˆ‘ä»¬é€šè¿‡onConfirmæ¥å®ç°ç‚¹å‡»ç¡®å®š
  }
  if (typeof options === 'object') { // åœ¨è¿™é‡Œæˆ‘ä»¬é€šè¿‡optionsï¼Œå’Œconfirmï¼Œcancelé‡å†™äº†å®ä¾‹é‡Œé¢çš„æ–¹æ³•
    Object.assign(currentGoLogin, options, { showModal: true, confirm, cancel: close })
  }
}
export default GoLogin

```

> æˆ‘æˆ‘ä»¬æ‹¦æˆªåˆ°401è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä¸»åŠ¨å¼¹å‡ºæˆ‘ä»¬è‡ªå®šä¹‰çš„å¼¹çª—äº†

```js
...........
    if (res.statusCode === 401) {
        GoLogin.show({
            onConfirm () {
                if (getCurrentPageUrlWithArgs().url !== 'pages/login/h5') {
                    store.commit('RETURN_URL', getCurrentPageUrlWithArgs())
                }
                loginJump()
            }
        })
    }
............
```

