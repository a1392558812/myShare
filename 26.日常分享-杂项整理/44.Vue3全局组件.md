## Vue3å…¨å±€ç»„ä»¶

> ä¹‹å‰æœ‰vue2çš„é€šè¿‡jsè°ƒç”¨çš„å…¨å±€ç»„ä»¶ï¼Œvue3å‡ºæ¥äº†ï¼Œ
>
> é‚£emmmmmmmmmmmæŠŠæ¡ä¸€ä¸‹ï¼Ÿ

* dialog

  emmmmmmæ ·å¼å¾ˆä¸‘ï¼Œæ˜¯é‚£ä¸ªæ„æ€å°±è¡Œ

```vue
<template>
  <div v-if="ifShow" class="dialog-wrap" @click="dialogOutClose">
    <div class="dialog" @click.stop="return">
      <div v-if="showHeader" class="header">{{title}}</div>
      <slot name="content">
        <div class="content">{{content}}</div>
      </slot>
      <div v-if="showFooter" class="footer">
        <div @click="dialogConfirm">ç¡®å®š</div>
        <div @click="dialogClose">å…³é—­</div>
      </div>
    </div>
  </div>
</template>

<script>
import { defineComponent, ref } from 'vue'
export default defineComponent({
  name: 'dialog',
  props: {
    showHeader: { // æ˜¯å¦æ˜¾ç¤ºå¤´éƒ¨
      type: Boolean,
      default: true
    },
    showFooter: { // æ˜¯å¦æ˜¾ç¤ºåº•éƒ¨
      type: Boolean,
      default: true
    },
    dialogABool: { // æ˜¯å¦é»˜è®¤æ‰“å¼€
      type: Boolean,
      default: false
    },
    maskClose: { // ç‚¹å‡»é®ç½©æ˜¯å¦å¯ä»¥å…³é—­
      type: Boolean,
      default: true
    },
    open: { // è‡ªå®šä¹‰æ‰“å¼€äº‹ä»¶
      type: Function
    },
    confirm: { // è‡ªå®šä¹‰ç¡®è®¤äº‹ä»¶
      type: Function
    },
    close: { // è‡ªå®šä¹‰å…³é—­äº‹ä»¶
      type: Function
    },
    title: { // æ ‡é¢˜
      type: String,
      default: 'è¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜'
    },
    content: { // å†…å®¹
      type: String,
      default: 'è¿™æ˜¯ä¸€ä¸ªå†…å®¹'
    }
  },
  setup (props, context) {
    const ifShow = ref(props.dialogABool)
    const dialogOpen = () => {
      // æ¥æ”¶ä¼ å…¥çš„openå‡½æ•°ï¼Œé‡å†™é»˜è®¤çš„dialogæ‰“å¼€é€»è¾‘,æ¯”å¦‚å‘é€è¯·æ±‚æ—¶éœ€è¦ç­‰ä¸€æ®µæ—¶é—´
      // æš´éœ²closeCallbackå‡½æ•°ï¼Œæ˜¯ä¸€ä¸ªå…³é—­dialogæ–¹æ³•ï¼Œè‡ªè¡ŒåŠ¨æ€åˆ¤æ–­ä½•æ—¶éœ€è¦å…³é—­
      if (props.open) {
        props.open(closeCallback)
      } else {
        console.log('é»˜è®¤çš„æ‰“å¼€é€»è¾‘')
        openCallback()
      }
      context.emit('open')
    }
    const dialogConfirm = () => {
      if (props.confirm) {
        props.confirm(closeCallback)
      } else {
        console.log('é»˜è®¤çš„ç¡®è®¤é€»è¾‘')
        closeCallback()
      }
    }
    const dialogClose = () => {
      if (props.close) {
        props.close(closeCallback)
      } else {
        defaultClose()
      }
      context.emit('close')
    }
    const dialogOutClose = () => {
      if (props.maskClose) {
        defaultClose()
      }
    }

    const defaultClose = () => {
      console.log('é»˜è®¤çš„å…³é—­é€»è¾‘')
      closeCallback()
    }
    const openCallback = () => {
      ifShow.value = true
    }
    const closeCallback = () => {
      ifShow.value = false
    }
    return {
      ifShow,
      dialogConfirm,
      dialogOpen,
      dialogClose,
      dialogOutClose
    }
  }
})
</script>

<style scoped lang="scss">
  .dialog-wrap{
    position: fixed;
    left: 0;
    top: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0,0,0.6);
    z-index: 1000;
    .dialog{
      padding: 10px;
      border-radius: 10px;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 800px;
      height: 500px;
      background: #fff;
      z-index: 1100;
      .header{

      }
      .content{

      }
      .footer{

      }
    }
  }
</style>

```

* dialog.js

```js
import { createApp } from 'vue'
import dialog from './dialog.vue'
let instance
function mountComponent (RootComponent, options) {
  const app = createApp(<RootComponent {...options}/>)
  // æ­¤å¤„æ›¾è®¾æƒ³æ¥å—ä¸€ä¸ªç»„ä»¶å‚æ•°ï¼Œé€šè¿‡jsæ–¹æ³•ä¼ å…¥ç»„ä»¶ä¹Ÿèƒ½åŠ¨æ€æ¸²æŸ“ï¼Œæ²¡å®ç°
  console.log('app', app)
  const root = document.createElement('div')
  document.body.appendChild(root)
  return {
    instance: app.mount(root),
    unmount () {
      app.unmount()
      document.body.removeChild(root)
    }
  }
}

const mountContent = (options = {}) => {
  let flag // æ˜¯å¦ä¸å­˜åœ¨å®ä¾‹
  if (!instance) {
    flag = true
  } else {
    flag = !instance.instance
  }
  if (flag) {
    instance = mountComponent(dialog, Object.assign({ dialogABool: true }, options))
  } else {
    instance.unmount()
    instance = null
    mountContent(options)
  }
}

export default mountContent

```

* main.js

```js
import mountContent from './components/dialog'
const app = createApp(App)
app.provide('$mountContent', mountContent)
```

> ä½¿ç”¨

```vue
<template>
  <div id="nav">
    <router-link to="/">Home</router-link> |
    <router-link to="/about">About</router-link>
    <div @click="test">6666</div>
    <div @click="test2">ğŸ®ğŸº</div>
    <div @click="test3">è€å…«ç§˜åˆ¶å°æ±‰å ¡</div>
  </div>
  <router-view/>
</template>
<script>
import { inject } from 'vue'
import test5 from '../../my-project/src/components/test5'
export default {
  setup (props, context) {
    const $mountContent = inject('$mountContent')
    const test = () => {
      $mountContent({
        confirm: (callback) => {
          console.log('confirmå›è°ƒè¦æä¸€äº›äº‹æƒ…')
          callback()
        },
        close: (callback) => {
          console.log('closeå›è°ƒ')
          callback()
        }
      })
    }
    const test2 = () => {
      $mountContent({
        content: 'å‡†å¤‡æäº‹æƒ…',
        confirm: (callback) => {
          console.log('test2-confirmå›è°ƒè¦æä¸€äº›äº‹æƒ…')
          callback()
        },
        close: (callback) => {
          console.log('test2-closeå›è°ƒ')
          callback()
        }
      })
    }
    const test3 = () => { // emmmmmmmæ²¡å®ç°ï¼Œè®¾æƒ³ä¼ å…¥ä¸ªç»„ä»¶åŠ¨æ€æ˜¾ç¤º
      $mountContent({
        title: 'å’±å®¶çš„æ–°æ ‡é¢˜',
        confirm: (callback) => {
          console.log('è¯•ä¸€è¯•confirmå›è°ƒè¦æä¸€äº›äº‹æƒ…')
          callback()
        },
        contentContent: test5
      })
    }
    return {
      test,
      test2,
      test3
    }
  }
}
</script>
<style lang="scss"></style>
```

> åŒç†ï¼Œåœ¨å‘é€è¯·æ±‚æˆ–è€…å…¶ä»–çš„ä¸€äº›åœ°æ–¹ï¼Œæ¯”å¦‚æ‹¦æˆªå“åº”çš„401æé†’ç™»é™†ç­‰....